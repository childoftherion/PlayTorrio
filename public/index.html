﻿<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>Ayman's PlayTorrio</title>
    
    <!-- External Libraries -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet"/>
    <link href="https://vjs.zencdn.net/8.10.0/video-js.css" rel="stylesheet" />
    
    <!-- Critical CSS (inline for performance) -->
    <style>
        /* Critical performance CSS */
        * { -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; }
        .movie-card, .genre-card, .episode-card, .slider-item, .btn { transform: translateZ(0); backface-visibility: hidden; }
        .movies-grid, .genre-grid, .episodes-grid { contain: layout style; }
        main, .app-main { -webkit-overflow-scrolling: touch; }
        img { image-rendering: -webkit-optimize-contrast; }
        .movie-card, .genre-card { content-visibility: auto; contain-intrinsic-size: 200px 350px; }
        .movie-poster { aspect-ratio: 2/3; object-fit: cover; }
    </style>
    
    <!-- All Original CSS (temporary - includes both old and new UI styles) -->
    <link rel="stylesheet" href="css/all-original.css">
    
    <!-- Modular CSS Files (these will override/supplement the original) -->
    <link rel="stylesheet" href="css/variables.css">
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/titlebar.css">
    <link rel="stylesheet" href="css/header.css">
    <link rel="stylesheet" href="css/buttons.css">
    <link rel="stylesheet" href="css/cards.css">
    <link rel="stylesheet" href="css/downloader.css">
    <link rel="stylesheet" href="css/livetv.css">
    <link rel="stylesheet" href="css/modals.css">
    <link rel="stylesheet" href="css/episodes.css">
    <link rel="stylesheet" href="css/torrents.css">
    <link rel="stylesheet" href="css/settings.css">
    <link rel="stylesheet" href="css/books-music.css">
    <link rel="stylesheet" href="css/navigation.css">
    <link rel="stylesheet" href="css/player.css">
    <link rel="stylesheet" href="css/readers.css">
    <link rel="stylesheet" href="css/server-selection.css">
    <link rel="stylesheet" href="css/booktorrio.css">
    <link rel="stylesheet" href="css/trakt.css">
    <link rel="stylesheet" href="css/notifications.css">
    
    <!-- Google Cast SDK -->
    <script src="https://www.gstatic.com/cv/js/sender/v1/cast_sender.js?loadCastFramework=1"></script>
</head>
<body class="ui-new">
<!-- Notification Element -->
<div id="notification" class="notification"></div>

<!-- Custom Title Bar -->
<div class="custom-title-bar" id="customTitleBar">
    <div class="title-bar-left">
        <i class="fas fa-play-circle" style="color: var(--vlc-orange);"></i>
        <span class="title-bar-title">PlayTorrio</span>
    </div>
    <div class="title-bar-controls">
        <button class="title-bar-btn" id="minimizeBtn" title="Minimize">
            <svg xmlns="http://www.w3.org/2000/svg" width="10" height="10" viewBox="0 0 12 12" fill="currentColor"><rect x="1" y="5.5" width="10" height="1"/></svg>
        </button>
        <button class="title-bar-btn" id="maximizeBtn" title="Maximize">
            <svg xmlns="http://www.w3.org/2000/svg" width="10" height="10" viewBox="0 0 12 12" fill="none" stroke="currentColor" stroke-width="1"><rect x="2" y="2" width="8" height="8"/></svg>
        </button>
        <button class="title-bar-btn title-bar-close" id="closeBtn" title="Close">
            <svg xmlns="http://www.w3.org/2000/svg" width="10" height="10" viewBox="0 0 12 12" fill="none" stroke="currentColor" stroke-width="1"><path d="M2 2 L10 10 M10 2 L2 10"/></svg>
        </button>
    </div>
</div>
<!-- API Setup Modal - REMOVED -->

<!-- Donate modal removed -->

<!-- Discord Modal -->
<div class="discord-modal" id="discordModal">
    <div class="discord-content">
        <button class="discord-close" id="discordClose">
            <i class="fas fa-times"></i>
        </button>
        <h2 class="discord-title">
            <svg class="discord-logo" viewBox="0 0 71 55" fill="none" xmlns="http://www.w3.org/2000/svg">
                <g clip-path="url(#clip0)">
                    <path d="M60.1045 4.8978C55.5792 2.8214 50.7265 1.2916 45.6527 0.41542C45.5603 0.39851 45.468 0.440769 45.4204 0.525289C44.7963 1.6353 44.105 3.0834 43.6209 4.2216C38.1637 3.4046 32.7345 3.4046 27.3892 4.2216C26.905 3.0581 26.1886 1.6353 25.5617 0.525289C25.5141 0.443589 25.4218 0.40133 25.3294 0.41542C20.2584 1.2888 15.4057 2.8186 10.8776 4.8978C10.8384 4.9147 10.8048 4.9429 10.7825 4.9795C1.57795 18.7309 -0.943561 32.1443 0.293408 45.3914C0.299005 45.4562 0.335386 45.5182 0.385761 45.5576C6.45866 50.0174 12.3413 52.7249 18.1147 54.5195C18.2071 54.5477 18.305 54.5139 18.3638 54.4378C19.7295 52.5728 20.9469 50.6063 21.9907 48.5383C22.0523 48.4172 21.9935 48.2735 21.8676 48.2256C19.9366 47.4931 18.0979 46.6 16.3292 45.5858C16.1893 45.5041 16.1781 45.304 16.3068 45.2082C16.679 44.9293 17.0513 44.6391 17.4067 44.3461C17.471 44.2926 17.5606 44.2813 17.6362 44.3151C29.2558 49.6202 41.8354 49.6202 53.3179 44.3151C53.3935 44.2785 53.4831 44.2898 53.5502 44.3433C53.9057 44.6363 54.2779 44.9293 54.6529 45.2082C54.7816 45.304 54.7732 45.5041 54.6333 45.5858C52.8646 46.6197 51.0259 47.4931 49.0921 48.2228C48.9662 48.2707 48.9102 48.4172 48.9718 48.5383C50.038 50.6034 51.2554 52.5699 52.5959 54.435C52.6519 54.5139 52.7526 54.5477 52.845 54.5195C58.6464 52.7249 64.529 50.0174 70.6019 45.5576C70.6551 45.5182 70.6887 45.459 70.6943 45.3942C72.1747 30.0791 68.2147 16.7757 60.1968 4.9823C60.1772 4.9429 60.1437 4.9147 60.1045 4.8978ZM23.7259 37.3253C20.2276 37.3253 17.3451 34.1136 17.3451 30.1693C17.3451 26.225 20.1717 23.0133 23.7259 23.0133C27.308 23.0133 30.1626 26.2532 30.1066 30.1693C30.1066 34.1136 27.28 37.3253 23.7259 37.3253ZM47.3178 37.3253C43.8196 37.3253 40.9371 34.1136 40.9371 30.1693C40.9371 26.225 43.7636 23.0133 47.3178 23.0133C50.9 23.0133 53.7545 26.2532 53.6986 30.1693C53.6986 34.1136 50.9 37.3253 47.3178 37.3253Z" fill="white"/>
                </g>
                <defs>
                    <clipPath id="clip0">
                        <rect width="71" height="55" fill="white"/>
                    </clipPath>
                </defs>
            </svg>
            Join the Discord
        </h2>
        <div class="discord-message">
            <p>Suggest features, report bugs, be a part of the community, and help me make a better app.</p>
        </div>
        <div style="display:flex; gap:0.75rem; flex-wrap: wrap;">
            <button class="discord-join-btn" id="discordJoinBtn" style="flex:1;">
                <i class="fab fa-discord"></i>
                Join Discord
            </button>
            <button class="discord-join-btn" id="discordDontShowBtn" style="background: rgba(255,255,255,0.12); flex:1; color:#fff; text-shadow:0 0 4px rgba(0,0,0,0.6); font-weight:600;">
                <i class="fas fa-eye-slash"></i>
                Don't show again
            </button>
        </div>
    </div>
</div>

<!-- Settings Modal -->
<div class="settings-modal" id="settingsModal">
    <div class="settings-content">

        <div class="settings-header">
            <h2 class="settings-title">
                <i class="fas fa-cog"></i>
                Settings
            </h2>
            <button class="settings-close" id="settingsClose">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        

        <div class="settings-section">
            <h3>Jackett API Configuration</h3>
            <div class="current-api-key" id="currentApiKey">
                No API key configured
            </div>
            <div class="api-input-group">
                <label for="newApiKey">New API Key:</label>
                <input type="text" id="newApiKey" class="api-input" placeholder="Enter new Jackett API key..." />
            </div>
            <div class="api-input-group" style="margin-top:1rem;">
                <label for="jackettUrl">Jackett Base URL:</label>
                <input type="text" id="jackettUrl" class="api-input" placeholder="http://127.0.0.1:9117/api/v2.0/indexers/all/results/torznab" />
                <small style="color:var(--secondary); font-size:0.85rem; margin-top:0.25rem;">Default: http://127.0.0.1:9117/api/v2.0/indexers/all/results/torznab</small>
            </div>
        </div>

        <div class="settings-section" style="margin-top:1.25rem;">
            <h3>Streaming Mode</h3>
            <div style="margin-top:0.5rem; padding:1rem; border:1px solid rgba(255,255,255,0.15); border-radius:8px;background: rgba(255,255,255,0.05);">
                <label style="display:flex; align-items:center; gap:0.6rem; cursor:pointer;">
                    <input type="checkbox" id="useStreamingServersToggle" />
                    <span>Use Streaming Servers instead of Torrents</span>
                </label>
                <div style="margin-top:0.5rem; color:#10b981; font-size:0.9rem;">
                    Stream directly from web servers (faster startup, no downloads)
                </div>
                <div style="margin-top:0.25rem; color:#9ca3af; font-size:0.85rem;">
                    When enabled, movies/shows will stream from online servers instead of torrent files
                </div>
            </div>
        </div>

        <div class="settings-section" style="margin-top:1.25rem;">
            <h3>Cache & Storage</h3>
            <div style="margin-top:0.5rem; padding:1rem; border:1px solid rgba(255,255,255,0.15); border-radius:8px;background: rgba(255,255,255,0.05);">
                <div class="api-input-group">
                    <label for="cacheLocation">Cache Location:</label>
                    <div style="display:flex; gap:0.5rem; align-items:center;">
                        <input type="text" id="cacheLocation" class="api-input" readonly placeholder="System default temp folder" style="flex:1;" />
                        <button class="api-btn" id="selectCacheBtn" style="background:#0d6efd; color:#fff; white-space:nowrap;">
                            <i class="fas fa-folder-open"></i> Browse
                        </button>
                    </div>
                    <small style="color:var(--secondary); font-size:0.85rem; margin-top:0.25rem;">
                        <i class="fas fa-info-circle"></i> Location where WebTorrent streams and subtitles are cached
                    </small>
                </div>
            </div>
        </div>

        <div class="settings-section" id="debridSection" style="margin-top:1.25rem;">
            <h3>Debrid (Cloud Cache) </h3>
            <div style="margin-top:0.5rem; padding:1rem; border:1px solid rgba(255,255,255,0.15); border-radius:8px;background: rgba(255,255,255,0.05); display:flex; flex-direction: column; gap:0.75rem;">
                <label style="display:flex; align-items:center; gap:0.6rem; cursor:pointer;">
                    <input type="checkbox" id="useDebridToggle" />
                    <span>Use Debrid</span>
                </label>
                <div style="display:flex; gap:0.75rem; align-items:center; flex-wrap: wrap;">
                    <label for="debridProvider">Provider:</label>
                    <select id="debridProvider" class="api-input" style="min-width:220px; max-width:260px;">
                        <option value="realdebrid">Real-Debrid</option>
                        <option value="alldebrid">AllDebrid</option>
                        <option value="torbox">TorBox</option>
                        <option value="premiumize">Premiumize</option>
                    </select>
                    <span id="debridStatus" style="font-size:0.9rem; opacity:0.85;">Not logged in</span>
                </div>
                <div class="api-input-group" id="rdClientIdGroup">
                    <label for="rdClientId">Real-Debrid Client ID (device flow):</label>
                    <input type="text" id="rdClientId" class="api-input" placeholder="Enter your RD Client ID (e.g., XXXXXXXXXXXXX)" />
                </div>
                <div id="rdButtons" style="display:flex; gap:0.5rem; flex-wrap: wrap; align-items:center;">
                    <button class="api-btn" id="rdDeviceLogin" style="background:#198754; color:#fff;">
                        <i class="fas fa-sign-in-alt"></i> Login with Real-Debrid
                    </button>
                    <small style="opacity:0.85;">No password needed. Authenticate on real-debrid.com using a short code.</small>
                </div>
            </div>
        </div>

        <div class="settings-section" style="margin-top:1.25rem;">
            <h3>User Interface</h3>
            <div style="margin-top:0.5rem; padding:1rem; border:1px solid rgba(255,255,255,0.15); border-radius:8px;background: rgba(255,255,255,0.05);">
                <div style="margin-bottom:1rem; padding-bottom:0.75rem; border-bottom:1px solid rgba(255,255,255,0.1);">
                    <label style="display:flex; align-items:center; gap:0.6rem; cursor:pointer;">
                        <input type="checkbox" id="fullscreenToggle" />
                        <span><i class="fas fa-expand-arrows-alt" style="margin-right:0.25rem; color:var(--vlc-orange);"></i><strong>Fullscreen Mode</strong></span>
                    </label>
                    <div style="margin-top:0.25rem; color:var(--secondary); font-size:0.85rem; margin-left:1.85rem;">
                        <i class="fas fa-info-circle"></i> Toggle between fullscreen and windowed mode
                    </div>
                </div>
                
                <div style="display:flex; flex-direction:column; gap:0.75rem;">
                    <label style="display:flex; align-items:center; gap:0.6rem; cursor:pointer;">
                        <input type="radio" name="uiMode" value="new" id="uiModeNew" checked />
                        <span><strong>NEW UI</strong> - Modern app-like interface</span>
                    </label>
                    <label style="display:flex; align-items:center; gap:0.6rem; cursor:pointer;">
                        <input type="radio" name="uiMode" value="old" id="uiModeOld" />
                        <span><strong>OLD UI</strong> - Classic website layout</span>
                    </label>
                </div>
                <div style="margin-top:0.5rem; color:var(--secondary); font-size:0.9rem;">
                    <i class="fas fa-info-circle"></i> Changes will apply immediately after saving
                </div>
                
                <div style="margin-top:1.5rem; padding-top:1rem; border-top:1px solid rgba(255,255,255,0.1);">
                    <label style="display:block; margin-bottom:0.75rem; color:var(--light); font-weight:600; font-size:1rem;">
                        <i class="fas fa-palette" style="margin-right:0.5rem; color:var(--vlc-orange);"></i>
                        Color Theme
                    </label>
                    <select id="themeSelector" class="api-input" style="width:100%; max-width:350px; padding:0.75rem 1rem;background: rgba(255,255,255,0.08); border: 2px solid rgba(255,255,255,0.2); border-radius:10px; color:var(--light); font-size:0.95rem;">
                        <option value="default">Default (Purple Dream)</option>
                        <option value="green-forest">Green Forest</option>
                        <option value="cyberpunk-neon">Cyberpunk Neon</option>
                        <option value="ocean-breeze">Ocean Breeze</option>
                        <option value="cherry-blossom">Cherry Blossom</option>
                        <option value="midnight-dark">Midnight Dark</option>
                        <option value="sunset-orange">Sunset Orange</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Nuvio Febbox Token Section -->
        <div class="settings-section" style="margin-top:1.25rem;">
            <h3>
                <i class="fas fa-stream" style="color: #667eea; margin-right: 0.5rem;"></i>
                Nuvio Configuration
            </h3>
            <div style="padding:1rem; border:1px solid rgba(255,255,255,0.15); border-radius:8px;background: rgba(255,255,255,0.05);">
                <div style="margin-bottom: 1rem; color: var(--secondary); font-size: 0.9rem;">
                    <i class="fas fa-info-circle"></i>
                    Configure your Febbox token for Nuvio streaming (ShowBox). A default token is provided, but you can use your own.
                </div>

                <label for="febboxTokenInput" style="display: block; margin-bottom: 0.5rem; font-weight: 500;">
                    Febbox JWT Token (Optional)
                </label>
                <input 
                    type="text" 
                    id="febboxTokenInput" 
                    placeholder="Leave empty to use default token or paste your Febbox JWT token here"
                    style="width: 100%; padding: 0.75rem;background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: var(--light); font-size: 0.95rem; font-family: monospace; margin-bottom: 1rem;"
                />

                <button id="saveFebboxToken" class="btn" style="width: 100%;">
                    <i class="fas fa-save"></i> Save Token
                </button>

                <div style="margin-top: 1rem; padding: 0.75rem;background: rgba(103, 126, 234, 0.1); border-left: 3px solid var(--secondary); border-radius: 4px; font-size: 0.85rem;">
                    <i class="fas fa-check-circle" style="color: var(--secondary);"></i> Default token is active. You can continue using Nuvio without adding your own token.
                </div>

                <!-- NodeMPV Player Toggle (Windows Only) -->
                <div id="nodempvSectionMain" style="margin-top: 1.5rem; padding-top: 1.5rem; border-top: 1px solid rgba(255,255,255,0.1); display: none;">
                    <div style="display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 1rem;">
                        <div style="flex: 1; min-width: 200px;">
                            <label style="font-weight: 500; display: flex; align-items: center; gap: 0.5rem;">
                                <i class="fas fa-play-circle" style="color: #ff6b35;"></i>
                                Use MPV Player
                            </label>
                            <div style="font-size: 0.85rem; color: var(--gray); margin-top: 0.25rem;">
                                Better codec support (DTS, TrueHD), hardware acceleration. Requires <a href="https://mpv.io/installation/" target="_blank" style="color: #ff6b35;">MPV</a> installed.
                            </div>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="useNodeMPVToggleMain">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>
            </div>
        </div>



        <!-- Trakt Integration Section -->
        <div class="settings-section" style="margin-top:1.25rem;">
            <h3>
                <i class="fas fa-tv" style="color: #ed1c24; margin-right: 0.5rem;"></i>
                Trakt Integration
            </h3>
            <div style="padding:1rem; border:1px solid rgba(255,255,255,0.15); border-radius:8px;background: rgba(255,255,255,0.05);">
                <div style="margin-bottom: 1rem; color: var(--secondary); font-size: 0.9rem;">
                    <i class="fas fa-info-circle"></i>
                    Sync your watch history, progress, and manage your watchlist with Trakt.tv
                </div>
                
                <div id="traktNotConnected" style="display: block;">
                    <div style="margin-bottom: 1rem;">
                        <span id="traktStatus" style="color: #dc3545; font-weight: 500;">
                            <i class="fas fa-times-circle"></i> Not connected
                        </span>
                    </div>
                    <div style="display: flex; gap: 0.75rem; align-items: center; flex-wrap: wrap;">
                        <button class="api-btn" id="traktLogin" style="background: #ed1c24; color: #fff;">
                            <i class="fas fa-sign-in-alt"></i> Connect to Trakt
                        </button>
                        <small style="opacity: 0.85;">Authenticate with your Trakt.tv account using a secure device code</small>
                    </div>
                </div>

                <div id="traktConnected" style="display: none;">
                    <div style="margin-bottom: 1rem;">
                        <span id="traktConnectedStatus" style="color: #198754; font-weight: 500;">
                            <i class="fas fa-check-circle"></i> Connected as <span id="traktUsername">User</span>
                        </span>
                    </div>
                    <div style="display: flex; gap: 0.75rem; align-items: center; flex-wrap: wrap; margin-bottom: 1rem;">
                        <button class="api-btn" id="traktViewWatchlist" style="background: #0d6efd; color: #fff;">
                            <i class="fas fa-list"></i> View Watchlist
                        </button>
                        <button class="api-btn" id="traktViewHistory" style="background: #6f42c1; color: #fff;">
                            <i class="fas fa-history"></i> View History
                        </button>
                        <button class="api-btn" id="traktViewStats" style="background: #17a2b8; color: #fff;">
                            <i class="fas fa-chart-bar"></i> View Stats
                        </button>
                    </div>
                    <div style="display: flex; gap: 0.75rem; align-items: center; flex-wrap: wrap;">
                        <button class="api-btn api-btn-secondary" id="traktDisconnect">
                            <i class="fas fa-sign-out-alt"></i> Disconnect
                        </button>
                    </div>
                </div>

                <div id="traktCodePanel" style="display: none; margin-top: 1rem; padding: 0.75rem;background: rgba(0,0,0,0.35); border: 1px solid rgba(255,255,255,0.1); border-radius: 8px;">
                    <div style="display: flex; align-items: center; gap: 0.5rem; flex-wrap: wrap; margin-bottom: 0.5rem;">
                        <div>Device Code:</div>
                        <div id="traktUserCode" style="font-family: monospace; font-weight: 800;background: rgba(255,255,255,0.1); padding: 0.25rem 0.5rem; border-radius: 6px;">----</div>
                        <button class="api-btn" id="traktCopyCode" style="padding: 0.4rem 0.6rem;background: #0d6efd; color: #fff;">
                            <i class="fas fa-copy"></i> Copy
                        </button>
                    </div>
                    <div style="display: flex; align-items: center; gap: 0.5rem; flex-wrap: wrap;">
                        <div>Authorize at:</div>
                        <a id="traktVerifyUrl" href="#" target="_blank" style="color: #0d6efd; text-decoration: underline;">https://trakt.tv/activate</a>
                        <button class="api-btn" id="traktOpenVerify" style="padding: 0.4rem 0.6rem;background: #0d6efd; color: #fff;">
                            <i class="fas fa-external-link-alt"></i> Open
                        </button>
                        <span id="traktLoginStatus" style="margin-left: auto; font-size: 0.9rem; opacity: 0.9;">Waiting for authorization…</span>
                        <button class="api-btn api-btn-secondary" id="traktCancelLogin">
                            <i class="fas fa-times"></i> Cancel
                        </button>
                    </div>
                </div>

                <div id="traktSettings" style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid rgba(255,255,255,0.1);">
                    <h4 style="margin-bottom: 0.75rem; color: var(--text-primary);">Scrobbling Settings</h4>
                    <div style="display: flex; flex-direction: column; gap: 0.5rem;">
                        <label style="display: flex; align-items: center; gap: 0.6rem; cursor: pointer;">
                            <input type="checkbox" id="traktAutoScrobble" checked />
                            <span>Automatically track what I watch</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 0.6rem; cursor: pointer;">
                            <input type="checkbox" id="traktScrobbleProgress" checked />
                            <span>Sync watch progress</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 0.6rem; cursor: pointer;">
                            <input type="checkbox" id="traktSyncWatchlist" checked />
                            <span>Show Trakt watchlist items in search</span>
                        </label>
                    </div>
                    <div style="margin-top: 0.5rem; color: var(--secondary); font-size: 0.85rem;">
                        <i class="fas fa-info-circle"></i> Your viewing activity will automatically sync to Trakt.tv
                    </div>
                </div>
            </div>
        </div>
        
        <div class="settings-buttons">
            <button class="api-btn api-btn-secondary" id="cancelSettings">
                <i class="fas fa-times"></i>
                Cancel
            </button>
            <button class="api-btn api-btn-primary" id="saveSettings">
                <i class="fas fa-save"></i>
                Save Changes
            </button>
        </div>

    </div>
</div>


<!-- Floating Navigation Arrow (Old UI Only, Home Page Only) -->
<div class="floating-nav-container" id="floatingNavContainer">
    <button class="floating-nav-btn" id="floatingNavBtn">
        <i class="fas fa-chevron-up" id="floatingNavIcon"></i>
    </button>
    <div class="floating-nav-menu" id="floatingNavMenu">
        <div class="floating-nav-item" data-action="settings">
            <i class="fas fa-cog"></i>
            <span>Settings</span>
        </div>
        <div class="floating-nav-item" data-action="home">
            <i class="fas fa-home"></i>
            <span>Home</span>
        </div>
        <div class="floating-nav-item" data-action="genres">
            <i class="fas fa-layer-group"></i>
            <span>Genres</span>
        </div>
        <div class="floating-nav-item" data-action="my-list">
            <i class="fas fa-list"></i>
            <span>My List</span>
        </div>
        <div class="floating-nav-item" data-action="done-watching">
            <i class="fas fa-check-double"></i>
            <span>Done Watching</span>
        </div>
        <div class="floating-nav-item" data-action="trakt">
            <i class="fas fa-tv"></i>
            <span>Trakt</span>
        </div>
        <div class="floating-nav-item" data-action="livetv">
            <i class="fas fa-broadcast-tower"></i>
            <span>Live TV</span>
        </div>
        <div class="floating-nav-item" data-action="iptv">
            <i class="fas fa-tv"></i>
            <span>IPTV</span>
        </div>
        <div class="floating-nav-item" data-action="books">
            <i class="fas fa-book"></i>
            <span>Books</span>
        </div>
        <div class="floating-nav-item" data-action="audiobooks">
            <i class="fas fa-headphones"></i>
            <span>AudioBooks</span>
        </div>
        <div class="floating-nav-item" data-action="booktorrio">
            <i class="fas fa-book-open"></i>
            <span>BookTorrio</span>
        </div>
        <div class="floating-nav-item" data-action="anime">
            <i class="fas fa-dragon"></i>
            <span>Anime</span>
        </div>
        <div class="floating-nav-item" data-action="comics">
            <i class="fas fa-mask"></i>
            <span>Comics</span>
        </div>
        <div class="floating-nav-item" data-action="manga">
            <i class="fas fa-book-dead"></i>
            <span>Manga</span>
        </div>
        <div class="floating-nav-item" data-action="music">
            <i class="fas fa-music"></i>
            <span>Music</span>
        </div>
        <div class="floating-nav-item" data-action="games-downloader">
            <i class="fas fa-download"></i>
            <span>Games Downloader</span>
        </div>
        <div class="floating-nav-item" data-action="minigames">
            <i class="fas fa-gamepad"></i>
            <span>MiniGames</span>
        </div>
        <div class="floating-nav-item" data-action="downloader">
            <i class="fas fa-download"></i>
            <span>Media Downloader</span>
        </div>
        <div class="floating-nav-item" data-action="trakt">
            <i class="fab fa-trakt"></i>
            <span>Trakt</span>
        </div>
        <a href="casino.html" class="floating-nav-item acebet-nav-item" id="acebet-floating-btn" style="color: #10b981; border: 1px solid rgba(16, 185, 129, 0.3); position: relative; padding-right: 28px;">
            <div class="acebet-nav-particles">
                <span style="position:absolute;width:3px;height:3px;background:#10b981;border-radius:50%;top:20%;left:10%;animation:acebet-float 2s ease-in-out infinite;"></span>
                <span style="position:absolute;width:3px;height:3px;background:#10b981;border-radius:50%;top:60%;right:15%;animation:acebet-float 2s ease-in-out infinite 0.5s;"></span>
            </div>
            <span style="font-weight:bold;font-size:1.1rem;">♠</span>
            <span>Ace Bet</span>
            <button class="acebet-floating-close" onclick="event.preventDefault(); event.stopPropagation(); hideSponsor();" style="position:absolute; right:6px; top:50%; transform:translateY(-50%); width:16px; height:16px;background:#dc3545; border:none; border-radius:50%; display:flex; align-items:center; justify-content:center; cursor:pointer; z-index:10; padding:0; font-size:10px; color:white; line-height:1;">&times;</button>
        </a>
    </div>
</div>

<!-- MPV Install Helper Modal removed -->

<!-- App Container for New UI -->
<div class="app-container">
    <!-- Sidebar Navigation (New UI Only) -->
    <aside class="app-sidebar" id="appSidebar">
        <div class="sidebar-logo" id="sidebarLogo" style="cursor: pointer; display: flex; justify-content: space-between; align-items: center;">
            <div style="display: flex; align-items: center; gap: 0.75rem;">
                <i class="fas fa-play-circle"></i>
                <div><span style="color: var(--vlc-orange);">Play</span>Torrio</div>
            </div>
            <button class="sidebar-close-btn" id="sidebarCloseBtn" title="Hide Sidebar" style="background: transparent; border: none; color: rgba(255,255,255,0.6); cursor: pointer; padding: 0.5rem; transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94), transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1); border-radius: 6px;">
                <i class="fas fa-times" style="font-size: 1.2rem;"></i>
            </button>
        </div>
        
        <div class="sidebar-divider"></div>
        
        <nav class="sidebar-nav">
            <div class="nav-section-title">DISCOVER</div>
            <div class="nav-item active" data-page="home">
                <i class="fas fa-home"></i>
                <span>Home</span>
                <span class="nav-badge">New</span>
            </div>
            <div class="nav-item" data-page="genres">
                <i class="fas fa-layer-group"></i>
                <span>Genres</span>
            </div>
            <div class="nav-item" id="customMagnetBtn" onclick="showCustomMagnetModal(); event.stopPropagation(); event.preventDefault(); return false;">
                <i class="fas fa-magnet"></i>
                <span>Play Magnet</span>
            </div>
            <div class="nav-item" data-page="my-list">
                <i class="fas fa-heart"></i>
                <span>My List</span>
            </div>
            <div class="nav-item" data-page="done-watching">
                <i class="fas fa-check-circle"></i>
                <span>Done Watching</span>
            </div>
            
            <div class="nav-section-title">LIBRARY</div>
            
            <!-- Ace Bet Sponsor Button -->
            <div class="nav-item acebet-nav-item" id="acebet-nav-btn" onclick="window.location.href='casino.html';" style="background: linear-gradient(135deg, rgba(16, 185, 129, 0.15), rgba(5, 150, 105, 0.1)); border: 1px solid rgba(16, 185, 129, 0.3); position: relative; overflow: visible; padding-right: 32px;">
                <div class="acebet-nav-particles">
                    <span class="acebet-particle-nav"></span>
                    <span class="acebet-particle-nav"></span>
                    <span class="acebet-particle-nav"></span>
                </div>
                <div style="width: 24px; height: 24px;background: linear-gradient(135deg, #10b981, #059669); border-radius: 6px; display: flex; align-items: center; justify-content: center; font-weight: 900; color: white; font-size: 14px;">A</div>
                <span style="color: #10b981; font-weight: 600;">Ace Bet</span>
                <span class="nav-badge" style="background: linear-gradient(135deg, #10b981, #059669);">Sponsor</span>
                <button id="acebet-close-btn" onclick="event.stopPropagation(); hideSponsor();" style="position:absolute; right:8px; top:50%; transform:translateY(-50%); width:18px; height:18px;background:#dc3545; border:none; border-radius:50%; display:flex; align-items:center; justify-content:center; cursor:pointer; z-index:10; padding:0; font-size:10px; color:white; line-height:1;">&times;</button>
            </div>
            
            <div class="nav-item" data-page="trakt">
                <i class="fas fa-tv" style="color: #ed1c24;"></i>
                <span>Trakt</span>
                <span class="nav-badge" style="background: #ed1c24;">Sync</span>
            </div>
            <div class="nav-item" data-page="livetv">
                <i class="fas fa-broadcast-tower" style="color: #10b981;"></i>
                <span>Live TV</span>
                <span class="nav-badge" style="background: linear-gradient(135deg, #10b981, #059669);">Live</span>
            </div>
            <div class="nav-item" data-page="iptv">
                <i class="fas fa-tv" style="color: #3b82f6;"></i>
                <span>IPTV</span>
                <span class="nav-badge" style="background: linear-gradient(135deg, #3b82f6, #2563eb);">M3U8</span>
            </div>
            <div class="nav-item" data-page="books">
                <i class="fas fa-book" style="color: #f59e0b;"></i>
                <span>Books</span>
                <span class="nav-badge" style="background: linear-gradient(135deg, #f59e0b, #d97706);">Z-Lib</span>
            </div>
            <div class="nav-item" data-page="audiobooks">
                <i class="fas fa-headphones" style="color: #8b5cf6;"></i>
                <span>AudioBooks</span>
                <span class="nav-badge" style="background: linear-gradient(135deg, #8b5cf6, #7c3aed);">Audio</span>
            </div>
            <div class="nav-item" data-page="booktorrio">
                <i class="fas fa-book-open" style="color: #06b6d4;"></i>
                <span>BookTorrio</span>
                <span class="nav-badge" style="background: linear-gradient(135deg, #06b6d4, #0891b2);">EPUB</span>
            </div>
            <div class="nav-item" data-page="anime">
                <i class="fas fa-dragon" style="color: #3b82f6;"></i>
                <span>Anime</span>
                <span class="nav-badge" style="background: linear-gradient(135deg, #3b82f6, #2563eb);">Nyaa</span>
            </div>

            <div class="nav-item" data-page="comics">
                <i class="fas fa-mask" style="color: #f97316;"></i>
                <span>Comics</span>
                <span class="nav-badge" style="background: linear-gradient(135deg, #f97316, #ea580c);">ReadComics</span>
            </div>
            <div class="nav-item" data-page="manga">
                <i class="fas fa-book-reader" style="color: #ec4899;"></i>
                <span>Manga</span>
                <span class="nav-badge" style="background: linear-gradient(135deg, #ec4899, #db2777);">Otaku</span>
            </div>
            <div class="nav-item" data-page="music">
                <i class="fas fa-music" style="color: #ec4899;"></i>
                <span>Music</span>
                <!-- Updated badge to reflect new music provider -->
                <span class="nav-badge" style="background: linear-gradient(135deg, #ec4899, #db2777);">Unlimited</span>
            </div>
            <div class="nav-item" data-page="games-downloader">
                <i class="fas fa-download" style="color: #8b5cf6;"></i>
                <span>Games Downloader</span>
                <span class="nav-badge" style="background: linear-gradient(135deg, #8b5cf6, #7c3aed);">PC</span>
            </div>
            <div class="nav-item" data-page="minigames">
                <i class="fas fa-gamepad" style="color: #10b981;"></i>
                <span>MiniGames</span>
                <span class="nav-badge" style="background: linear-gradient(135deg, #10b981, #059669);">Play</span>
            </div>
            <div class="nav-item" data-page="downloader">
                <i class="fas fa-download" style="color: #a855f7;"></i>
                <span>Media Downloader</span>
            </div>
            <div class="nav-item" id="sidebarClearCache">
                <i class="fas fa-trash"></i>
                <span>Clear Cache</span>
            </div>
        </nav>
        
        <!-- Quick Actions -->
        <div class="sidebar-quick-actions">
            <div class="quick-action-title">QUICK ACTIONS</div>
            <button class="quick-action-btn" id="quickRefresh">
                <i class="fas fa-sync-alt"></i>
                <span>Refresh</span>
            </button>
        </div>
        
        <div class="sidebar-footer">
            <div class="sidebar-user-info">
                <i class="fas fa-user-circle"></i>
                <span id="windowsUsername">Local User</span>
            </div>
            <button class="btn btn-primary" id="sidebarSettings" style="width: 100%; margin-top: 0.5rem;">
                <i class="fas fa-cog"></i> Settings
            </button>
        </div>
    </aside>
    
    <!-- Main App Content -->
    <div class="app-main">
        <!-- Header -->
        <header>
        <div class="header-container">
        <a class="logo" href="http://localhost:6987">
        <i class="fas fa-play-circle"></i>
        <span>Play</span> Torrio
                    </a>
        <div class="search-container" style="display:flex; align-items:center; gap:0.5rem;">
            <select id="searchSourceSelect" class="modal-select" style="max-width: 120px; padding: 0.5rem;background: rgba(255,255,255,0.06); border-radius: 20px; border: 1px solid rgba(168, 85, 247, 0.3); height: 42px;">
                <option value="tmdb">TMDB</option>
            </select>
            <div style="position:relative; flex:1;">
                <i class="fas fa-search search-icon"></i>
                <input id="searchInput" placeholder="Search for movies, shows, anime..." type="text"/>
            </div>
        </div>
        <div class="user-actions">
        <!-- Connection Status (NEW UI only) -->
        <div class="connection-status">
            <i class="fas fa-circle"></i>
            <span>Connected</span>
        </div>
        <button class="btn btn-outline" id="doneWatchingBtn">
            <i class="fas fa-check-circle"></i> <span>Done Watching</span>
        </button>
        <button class="btn btn-outline" id="clearCacheBtn">
            <i class="fas fa-trash"></i> <span>Clear Cache</span>
        </button>
    <!-- Donate button removed -->
        <button class="btn btn-outline" id="discordBtn" title="Join Discord Community">
            <i class="fab fa-discord"></i> <span>Discord</span>
        </button>
        <button class="btn btn-outline" id="genresBtn">
            <i class="fas fa-layer-group"></i> <span>Genres</span>
        </button>
        <button class="btn btn-outline" id="myListBtn">
            <i class="fas fa-heart"></i> <span>My List</span>
        </button>
        <button class="btn btn-primary" id="donateBtn" title="Support development" style="margin-left: 0.5rem;">
            <i class="fas fa-heart"></i> <span>Donate</span>
        </button>
        <!-- Install MPV button removed -->
        </div>
        </div>
        </header>

        <!-- Sidebar Toggle Button (shows when sidebar is hidden) -->
        <button class="sidebar-toggle-btn" id="sidebarToggleBtn" title="Show Sidebar">
            <i class="fas fa-bars"></i>
        </button>

<!-- Main Content -->
<main>
    <!-- Home Page -->
    <div id="homePage">
        <!-- Hero Section (New UI Only) -->
        <div class="hero-section" id="heroSection" style="display: none;">
            <img class="hero-backdrop" id="heroBackdrop" src="" alt="">
            <div class="hero-gradient"></div>
            <div class="hero-content">
                <h1 class="hero-title" id="heroTitle"></h1>
                <div class="hero-meta">
                    <div class="hero-rating" id="heroRating" style="display: none;">
                        <i class="fas fa-star"></i>
                        <span id="heroRatingValue"></span>
                    </div>
                    <span class="hero-year" id="heroYear"></span>
                    <span class="hero-runtime" id="heroRuntime" style="display: none;"></span>
                </div>
                <p class="hero-overview" id="heroOverview"></p>
                <div class="hero-buttons">
                    <button class="hero-btn hero-btn-primary" id="heroPlayBtn">
                        <i class="fas fa-play"></i>
                        Watch Now
                    </button>
                    <button class="hero-btn hero-btn-secondary" id="heroInfoBtn">
                        <i class="fas fa-info-circle"></i>
                        More Info
                    </button>
                </div>
            </div>
        </div>
        
        <!--back to Home Button (for search results) -->
        <div id="backToHomeBtn" style="display: none; margin-bottom: 2rem;">
            <button style="display: flex; align-items: center; gap: 0.75rem; padding: 1rem 2rem;background: linear-gradient(135deg, var(--vlc-orange) 0%, #ff8c42 100%); border: none; border-radius: 12px; color: white; font-size: 1.1rem; font-weight: 600; cursor: pointer; transition: all 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94), transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1); box-shadow: 0 4px 15px rgba(255, 111, 0, 0.3);" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(255, 111, 0, 0.5)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(255, 111, 0, 0.3)'">
                <i class="fas fa-arrow-left" style="font-size: 1.2rem;"></i>
                <span>Back to Home</span>
            </button>
        </div>
        
        <div class="categories">
            <div class="category active" data-category="all">
                <i class="fas fa-th"></i> All
            </div>
            <div class="category" data-category="movie">
                <i class="fas fa-film"></i> Movies
            </div>
            <div class="category" data-category="tv">
                <i class="fas fa-tv"></i> TV Shows
            </div>
        </div>
        
        <!-- Content Sliders (New UI Only) -->
        <div id="slidersContainer" style="display: none;">
            <!-- Continue Watching Slider (dynamic - only shows if items exist) -->
            <div class="slider-section" id="continueWatchingSection" style="display: none;">
                <div class="slider-header">
                    <h2 class="slider-title">
                        <i class="fas fa-clock"></i>
                        Continue Watching
                    </h2>
                    <div class="slider-nav">
                        <button class="slider-arrow slider-arrow-left" data-slider="continue">
                            <i class="fas fa-chevron-left"></i>
                        </button>
                        <button class="slider-arrow slider-arrow-right" data-slider="continue">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                </div>
                <div class="slider-container">
                    <div class="slider-track" id="continueWatchingSlider"></div>
                </div>
            </div>
            
            <!-- Trending Slider -->
            <div class="slider-section">
                <div class="slider-header">
                    <h2 class="slider-title">
                        <i class="fas fa-fire"></i>
                        Trending Now
                    </h2>
                    <div class="slider-nav">
                        <button class="slider-arrow slider-arrow-left" data-slider="trending">
                            <i class="fas fa-chevron-left"></i>
                        </button>
                        <button class="slider-arrow slider-arrow-right" data-slider="trending">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                </div>
                <div class="slider-container">
                    <div class="slider-track" id="trendingSlider"></div>
                </div>
            </div>
            
            <!-- Popular Movies Slider -->
            <div class="slider-section">
                <div class="slider-header">
                    <h2 class="slider-title">
                        <i class="fas fa-film"></i>
                        Popular Movies
                    </h2>
                    <div class="slider-nav">
                        <button class="slider-arrow slider-arrow-left" data-slider="popular">
                            <i class="fas fa-chevron-left"></i>
                        </button>
                        <button class="slider-arrow slider-arrow-right" data-slider="popular">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                </div>
                <div class="slider-container">
                    <div class="slider-track" id="popularSlider"></div>
                </div>
            </div>
            
            <!-- Top Rated Slider -->
            <div class="slider-section">
                <div class="slider-header">
                    <h2 class="slider-title">
                        <i class="fas fa-star"></i>
                        Top Rated
                    </h2>
                    <div class="slider-nav">
                        <button class="slider-arrow slider-arrow-left" data-slider="toprated">
                            <i class="fas fa-chevron-left"></i>
                        </button>
                        <button class="slider-arrow slider-arrow-right" data-slider="toprated">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                </div>
                <div class="slider-container">
                    <div class="slider-track" id="topratedSlider"></div>
                </div>
            </div>
            
            <!-- TV Shows Slider -->
            <div class="slider-section">
                <div class="slider-header">
                    <h2 class="slider-title">
                        <i class="fas fa-tv"></i>
                        Popular TV Shows
                    </h2>
                    <div class="slider-nav">
                        <button class="slider-arrow slider-arrow-left" data-slider="tvshows">
                            <i class="fas fa-chevron-left"></i>
                        </button>
                        <button class="slider-arrow slider-arrow-right" data-slider="tvshows">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                </div>
                <div class="slider-container">
                    <div class="slider-track" id="tvshowsSlider"></div>
                </div>
            </div>
        </div>
        
        <div id="addonCatalogsContainer" style="display: none; padding-bottom: 2rem;"></div>
        <div class="movies-grid" id="moviesGrid" style="content-visibility:auto; contain-intrinsic-size: 1000px 1000px;">
            <!-- Movie cards will be loaded here -->
        </div>
        <div class="loading" id="loadingIndicator" style="display: none;">
            <i class="fas fa-spinner"></i> Loading more content...
        </div>
    </div>

    <!-- Music Page -->
    <div id="music-page" style="display: none;">
        <div class="page-header-enhanced">
            <div class="page-title-section">
                <h2 class="section-title">
                    <i class="fas fa-music" style="color: #ec4899;"></i> <span>Music</span>
                </h2>
                <!-- Updated subtitle to reference Spotify-based streaming -->
                <p class="page-subtitle">Search and stream music powered by Spotify</p>
            </div>
            <div class="page-actions">
                <button class="action-btn" id="music-my-btn" title="Open My Music">
                    <i class="fas fa-heart"></i>
                    <span>My Music</span>
                </button>
                <button class="action-btn" id="music-my-albums-btn" title="Open My Albums">
                    <i class="fas fa-compact-disc"></i>
                    <span>My Albums</span>
                </button>
                <button class="action-btn" id="music-playlists-btn" title="Open Playlists">
                    <i class="fas fa-list"></i>
                    <span>Playlists</span>
                </button>
                <button class="action-btn" id="music-downloaded-btn" title="Open Downloaded Music">
                    <i class="fas fa-download"></i>
                    <span>Downloaded</span>
                </button>
                
            </div>
        </div>

        <div class="page-content">
            <!-- Search Section -->
            <div class="books-search-section">
                <div class="books-search-container">
                    <div class="books-search-bar">
                        <i class="fas fa-search books-search-icon"></i>
                        <input 
                            type="text" 
                            id="music-search-input" 
                            placeholder="Search for songs, artists, or albums..."
                            autocomplete="off"
                        />
                        <button id="music-search-btn" class="books-search-button">
                            <i class="fas fa-search"></i>
                            Search
                        </button>
                        <button id="music-album-search-btn" class="books-search-button" style="margin-left:0.5rem;background: linear-gradient(135deg, #38bdf8, #0ea5e9);">
                            <i class="fas fa-compact-disc"></i>
                            Albums
                        </button>
                    </div>
                </div>
            </div>

            <!-- Loading State -->
            <div id="music-loading" class="books-loading" style="display: none;">
                <div class="books-loading-spinner">
                    <i class="fas fa-spinner fa-spin"></i>
                </div>
                <p>Searching music...</p>
            </div>

            <!-- Empty State -->
            <div id="music-empty" class="books-empty">
                <div class="books-empty-icon">
                    <i class="fas fa-music"></i>
                </div>
                <h3>Welcome to Music</h3>
                <p>Search for any song, artist, or album to get started.</p>
            </div>

            <!-- Results Section -->
            <div id="music-results" class="books-results" style="display: none;">
                <div class="books-results-header">
                    <h3 id="music-results-title">Search Results</h3>
                    <div id="music-results-count" class="books-results-count"></div>
                </div>
                <div id="music-results-grid" class="books-results-grid">
                    <!-- Results will be populated here -->
                </div>
            </div>

            <!-- Albums Results Section -->
            <div id="music-albums" class="books-results" style="display:none;">
                <div class="books-results-header">
                    <h3 id="music-albums-title"><i class="fas fa-compact-disc" style="color:#38bdf8"></i> Album Results</h3>
                    <div id="music-albums-count" class="books-results-count"></div>
                </div>
                <div id="music-albums-grid" class="books-results-grid"></div>
            </div>

            <!-- Album View (open a specific album) -->
            <div id="music-album-view" class="books-results" style="display:none;">
                <div class="books-results-header" style="align-items:center; gap:1rem; flex-wrap:wrap;">
                    <div style="display:flex; align-items:center; gap:0.75rem;">
                        <img id="album-view-cover" src="" alt="Album Cover" style="width:68px; height:68px; border-radius:10px; object-fit:cover; border:1px solid rgba(255,255,255,0.1);">
                        <div>
                            <h3 id="album-view-title" style="margin:0; display:flex; align-items:center; gap:0.5rem;"></h3>
                            <div id="album-view-meta" style="color:#9ca3af; font-size:0.9rem;"></div>
                        </div>
                    </div>
                    <button id="album-play-all-btn" class="action-btn" style="background: linear-gradient(135deg, #ec4899, #a855f7);">
                        <i class="fas fa-play"></i>
                        <span>Play All</span>
                    </button>
                    <button id="album-save-all-btn" class="action-btn" title="Save all tracks to a playlist">
                        <i class="fas fa-plus"></i>
                        <span>Save All</span>
                    </button>
                    <button id="album-shuffle-btn" class="action-btn" title="Shuffle and play this album">
                        <i class="fas fa-random"></i>
                        <span>Shuffle</span>
                    </button>
                    <button id="album-close-btn" class="playlist-close-btn" style="margin-left:auto;">
                        <i class="fas fa-times"></i>
                        <span>Close Album</span>
                    </button>
                </div>
                <div id="album-tracks" class="album-tracks-list" style="display:flex; flex-direction:column; gap:0.5rem;"></div>
            </div>

            <!-- My Albums Section -->
            <div id="my-albums" class="books-results" style="display:none;">
                <div class="books-results-header">
                    <h3><i class="fas fa-compact-disc" style="color:#38bdf8"></i> My Albums</h3>
                    <div id="my-albums-count" class="books-results-count"></div>
                </div>
                <div id="my-albums-grid" class="books-results-grid"></div>
                <div id="my-albums-empty" class="books-empty" style="display:none;">
                    <div class="books-empty-icon"><i class="fas fa-compact-disc"></i></div>
                    <h3>No saved albums yet</h3>
                    <p>Click the heart on any album to add it here.</p>
                </div>
            </div>

            <!-- My Music Section -->
            <div id="my-music" class="books-results" style="display: none;">
                <div class="books-results-header" style="align-items:center; gap:1rem;">
                    <h3><i class="fas fa-heart" style="color:#ec4899"></i> My Music</h3>
                    <div id="my-music-count" class="books-results-count"></div>
                    <button id="my-music-play-all-btn" class="action-btn" style="margin-left:auto;background: linear-gradient(135deg, #ec4899, #a855f7);">
                        <i class="fas fa-play"></i>
                        <span>Play All</span>
                    </button>
                    <button id="my-music-shuffle-btn" class="action-btn" title="Shuffle and play My Music">
                        <i class="fas fa-random"></i>
                        <span>Shuffle</span>
                    </button>
                </div>
                <div id="my-music-grid" class="books-results-grid"></div>
                <div id="my-music-empty" class="books-empty" style="display:none;">
                    <div class="books-empty-icon"><i class="fas fa-heart"></i></div>
                    <h3>No saved tracks yet</h3>
                    <p>Click the heart on any track to add it here for quick access.</p>
                </div>
            </div>

            <!-- Playlists Section -->
            <div id="music-playlists" class="books-results" style="display: none;">
                <div class="books-results-header" style="gap: 1rem; align-items: center;">
                    <h3><i class="fas fa-list" style="color:#38bdf8"></i> Playlists</h3>
                    <div style="flex:1"></div>
                    <input id="playlist-name-input" placeholder="New playlist name" style="padding:0.5rem 0.75rem; border-radius:8px;background:var(--surface); border:1px solid var(--border); color:var(--light); width:220px;" />
                    <button class="action-btn" id="playlist-import-btn" title="Import playlist from JSON file"><i class="fas fa-file-import"></i><span>Import</span></button>
                    <button class="action-btn" id="playlist-create-btn"><i class="fas fa-plus"></i><span>Create</span></button>
                </div>
                <div id="playlists-list" class="books-results-grid"></div>
                <div id="playlists-empty" class="books-empty" style="display:none;">
                    <div class="books-empty-icon"><i class="fas fa-list"></i></div>
                    <h3>No playlists yet</h3>
                    <p>Create a playlist to get started.</p>
                </div>
            </div>

            <!-- Downloaded Music Section -->
            <div id="music-downloaded" class="books-results" style="display: none;">
                <div class="books-results-header" style="align-items:center; gap:1rem;">
                    <h3><i class="fas fa-download" style="color:#10b981"></i> Downloaded Music</h3>
                    <div id="music-downloaded-count" class="books-results-count"></div>
                    <div style="flex:1"></div>
                    <button class="action-btn" id="downloaded-play-all-btn" style="background: linear-gradient(135deg, #ec4899, #a855f7); display:none;">
                        <i class="fas fa-play"></i><span>Play All</span>
                    </button>
                    <button class="action-btn" id="downloaded-shuffle-btn" title="Shuffle and play all downloaded tracks" style="display:none;">
                        <i class="fas fa-random"></i><span>Shuffle</span>
                    </button>
                </div>
                <div id="music-downloaded-grid" class="books-results-grid"></div>
                <div id="music-downloaded-empty" class="books-empty" style="display:none;">
                    <div class="books-empty-icon"><i class="fas fa-download"></i></div>
                    <h3>No downloaded tracks yet</h3>
                    <p>Download tracks to listen offline.</p>
                </div>
            </div>

            
        </div>
    </div>

    <!-- Download Progress Modal -->
    <div id="music-download-modal" class="books-reader-modal" style="display:none;background: rgba(0,0,0,0.85);backdrop-filter: blur(10px); align-items: center; justify-content: center; padding: 0.75rem;">
        <div class="books-reader-content" style="max-width:300px; width:90%; margin: 0 auto; border:2px solid rgba(16,185,129,0.4); border-radius:12px; overflow:hidden; box-shadow: 0 12px 36px rgba(0,0,0,0.55);">
            <div style="background: linear-gradient(135deg, rgba(16,185,129,0.15), rgba(5,150,105,0.15)); border-bottom: 1px solid rgba(16,185,129,0.2); padding: 0.6rem 0.85rem; display: flex; align-items: center; justify-content: space-between;">
                <div style="display:flex; align-items:center; gap:0.4rem;">
                    <i class="fas fa-download" style="color:#10b981; font-size:0.85rem;"></i>
                    <span style="font-size:0.85rem; font-weight:600; color:var(--light);">Downloading</span>
                </div>
                <div style="display:flex; gap:0.25rem;">
                    <button id="music-download-minimize-btn" style="background:none; border:none; color:#38bdf8; cursor:pointer; padding:0.2rem 0.4rem; font-size:0.85rem; border-radius:4px; transition:background 0.2s;" onmouseover="this.style.background='rgba(56,189,248,0.1)'" onmouseout="this.style.background='none'" title="Minimize">
                        <i class="fas fa-minus"></i>
                    </button>
                    <button id="music-download-cancel-btn" style="background:none; border:none; color:#ef4444; cursor:pointer; padding:0.2rem 0.4rem; font-size:0.85rem; border-radius:4px; transition:background 0.2s;" onmouseover="this.style.background='rgba(239,68,68,0.1)'" onmouseout="this.style.background='none'" title="Cancel">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
            <div style="padding:0.85rem;">
                <div id="music-download-info" style="margin-bottom:0.6rem;">
                    <div id="music-download-song-name" style="font-weight:600; color:var(--light); margin-bottom:0.1rem; font-size:0.8rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;"></div>
                    <div id="music-download-artist-name" style="color:#10b981; font-size:0.75rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;"></div>
                </div>
                <div style="width:100%; height:5px;background: rgba(16,185,129,0.15); border-radius:2.5px; overflow:hidden; border: 1px solid rgba(16,185,129,0.2);">
                    <div id="music-download-progress-fill" style="height:100%; width:0%;background: linear-gradient(90deg, #10b981, #059669, #10b981);background-size: 200% 100%; animation: shimmer 2.5s cubic-bezier(0.45, 0, 0.55, 1) infinite; transition: width 0.7s cubic-bezier(0.25, 0.46, 0.45, 0.94);"></div>
                </div>
                <div id="music-download-status" style="margin-top:0.4rem; text-align:center; color:var(--secondary); font-size:0.75rem;"></div>
            </div>
        </div>
    </div>

    <!-- Minimized Download Progress (in notification area) -->
    <div id="music-download-minimized" style="display:none; position:fixed; bottom:20px; right:20px;background:rgba(26,26,46,0.95); border:2px solid rgba(16,185,129,0.4); border-radius:10px; padding:0.75rem 1rem; min-width:280px; box-shadow: 0 8px 24px rgba(0,0,0,0.4); z-index:9999;">
        <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom:0.5rem;">
            <div style="display:flex; align-items:center; gap:0.5rem;">
                <i class="fas fa-download" style="color:#10b981; font-size:0.9rem;"></i>
                <span style="font-size:0.85rem; font-weight:600; color:var(--light);">Downloading...</span>
            </div>
            <div style="display:flex; gap:0.25rem;">
                <button id="music-download-restore-btn" style="background:none; border:none; color:#38bdf8; cursor:pointer; padding:0.2rem 0.4rem; font-size:0.85rem; border-radius:4px; transition:background 0.2s;" onmouseover="this.style.background='rgba(56,189,248,0.1)'" onmouseout="this.style.background='none'" title="Restore">
                    <i class="fas fa-window-maximize"></i>
                </button>
                <button id="music-download-cancel-minimized-btn" style="background:none; border:none; color:#ef4444; cursor:pointer; padding:0.2rem 0.4rem; font-size:0.85rem; border-radius:4px; transition:background 0.2s;" onmouseover="this.style.background='rgba(239,68,68,0.1)'" onmouseout="this.style.background='none'" title="Cancel">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>
        <div id="music-download-minimized-info" style="margin-bottom:0.5rem;">
            <div id="music-download-minimized-song" style="font-weight:600; color:var(--light); font-size:0.8rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;"></div>
            <div id="music-download-minimized-artist" style="color:#10b981; font-size:0.75rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;"></div>
        </div>
        <div style="width:100%; height:5px;background: rgba(16,185,129,0.15); border-radius:2.5px; overflow:hidden; border: 1px solid rgba(16,185,129,0.2);">
            <div id="music-download-minimized-progress" style="height:100%; width:0%;background: linear-gradient(90deg, #10b981, #059669, #10b981);background-size: 200% 100%; animation: shimmer 2.5s cubic-bezier(0.45, 0, 0.55, 1) infinite; transition: width 0.7s cubic-bezier(0.25, 0.46, 0.45, 0.94);"></div>
        </div>
        <div id="music-download-minimized-status" style="margin-top:0.4rem; text-align:center; color:var(--secondary); font-size:0.75rem;"></div>
        <div id="music-download-queue-info" style="margin-top:0.5rem; padding-top:0.5rem; border-top:1px solid rgba(16,185,129,0.2); display:none;">
            <div style="font-size:0.75rem; color:var(--secondary); display:flex; align-items:center; justify-content:space-between;">
                <span><i class="fas fa-list" style="color:#10b981; margin-right:0.3rem;"></i>Queue:</span>
                <span id="music-download-queue-count" style="color:#10b981; font-weight:600;">0</span>
            </div>
        </div>
    </div>

    <!-- Music Player Modal (transparent overlay + custom controls) -->
    <div id="music-player-modal" class="books-reader-modal" style="display: none;background: rgba(0,0,0,0.85);backdrop-filter: blur(10px);">
        <div class="books-reader-content" style="border:2px solid #ec4899; border-radius: 16px; max-width:560px; width:90%;">
            <div class="books-reader-header">
                <button id="music-player-back" class="books-reader-back-btn">
                    <i class="fas fa-arrow-left"></i>
                   back
                </button>
                <h3 id="music-player-title">Now Playing</h3>
                <button id="music-player-minimize" class="books-reader-back-btn" style="margin-left: auto; margin-right: 0;">
                    <i class="fas fa-minus"></i>
                    Minimize
                </button>
            </div>
            <div class="books-reader-frame-container" style="display:flex; flex-direction:column; align-items:center; justify-content:center; padding: 1.75rem;background: linear-gradient(135deg, rgba(26,26,46,0.95), rgba(22,33,62,0.95));">
                <img id="music-player-cover" src="" alt="Album Cover" style="width: 240px; height: 240px; object-fit: cover; border-radius: 12px; margin-bottom: 1rem; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);">
                <h2 id="music-player-song-title" style="color: var(--light); margin-bottom: 0.25rem; text-align: center; font-size:1.3rem;"></h2>
                <p id="music-player-artist" style="color: #ec4899; font-size: 1rem; margin-bottom: 1rem; text-align: center;"></p>
                
                <!-- Custom Controls -->
                <div style="width:100%; max-width:520px;">
                    <div class="audio-progress-bar" id="music-progress-bar" style="width:100%; height:6px;background: rgba(255,255,255,0.12); border-radius:3px; cursor:pointer; overflow:hidden;">
                        <div class="audio-progress-fill" id="music-progress-fill" style="height:100%; width:0%;background: linear-gradient(90deg, #ec4899, #a855f7);"></div>
                    </div>
                    <div class="audio-time-display" style="display:flex; justify-content:space-between; color:#9ca3af; font-size:0.85rem; margin-top:0.5rem;">
                        <span id="music-current-time">0:00</span>
                        <span id="music-total-time">0:00</span>
                    </div>
                    <div class="audio-controls-buttons" style="display:flex; justify-content:center; align-items:center; gap:1rem; margin-top:1rem; flex-wrap:wrap;">
                        <button class="audio-control-btn" id="music-prev-track-btn" title="Previous track" style="background: rgba(236,72,153,0.1); border:1px solid rgba(236,72,153,0.3); color:#ec4899; border-radius:50%; width:42px; height:42px; display:flex; align-items:center; justify-content:center;"><i class="fas fa-step-backward"></i></button>
                        <button class="audio-control-btn" id="music-backward-btn" title="Back 10s" style="background: rgba(236,72,153,0.1); border:1px solid rgba(236,72,153,0.3); color:#ec4899; border-radius:50%; width:46px; height:46px; display:flex; align-items:center; justify-content:center;"><i class="fas fa-backward"></i></button>
                        <button class="audio-control-btn" id="music-play-pause-btn" title="Play/Pause" style="background: linear-gradient(135deg, #ec4899, #a855f7); color:white; border:none; border-radius:50%; width:56px; height:56px; display:flex; align-items:center; justify-content:center; font-size:1.1rem;"><i class="fas fa-play"></i></button>
                        <button class="audio-control-btn" id="music-forward-btn" title="Forward 10s" style="background: rgba(236,72,153,0.1); border:1px solid rgba(236,72,153,0.3); color:#ec4899; border-radius:50%; width:46px; height:46px; display:flex; align-items:center; justify-content:center;"><i class="fas fa-forward"></i></button>
                        <button class="audio-control-btn" id="music-next-track-btn" title="Next track" style="background: rgba(236,72,153,0.1); border:1px solid rgba(236,72,153,0.3); color:#ec4899; border-radius:50%; width:42px; height:42px; display:flex; align-items:center; justify-content:center;"><i class="fas fa-step-forward"></i></button>
                    </div>
                    <div style="display:flex; justify-content:center; align-items:center; margin-top:0.5rem;">
                        <button id="music-autoplay-toggle" title="Autoplay next track" style="display:inline-flex; align-items:center; gap:0.4rem; padding:0.35rem 0.7rem; border-radius:999px;background: rgba(236,72,153,0.08); border:1px solid rgba(236,72,153,0.35); color:#ec4899; font-weight:600;">
                            <i class="fas fa-play-circle"></i>
                            <span>Autoplay Next</span>
                        </button>
                    </div>
                    <div class="audio-volume-control" style="display:flex; align-items:center; gap:0.75rem; margin-top:1rem;">
                        <i class="fas fa-volume-up" id="music-volume-icon" style="color:#ec4899;"></i>
                        <div class="audio-volume-slider" id="music-volume-slider" style="flex:1; height:4px;background: rgba(255,255,255,0.12); border-radius:2px; cursor:pointer;">
                            <div class="audio-volume-fill" id="music-volume-fill" style="height:100%; width:100%;background:#ec4899;"></div>
                        </div>
                    </div>
                </div>

                <audio id="music-player-audio" style="display:none;" crossorigin="anonymous" preload="metadata"></audio>
            </div>
        </div>
    </div>

    <!-- Mini Music Player (Notification Style) -->
    <div id="music-mini-player" style="display: none; position: fixed; bottom: 1.5rem; right: 1.5rem; z-index: 10000;background: linear-gradient(135deg, rgba(26,26,46,0.98), rgba(22,33,62,0.98)); border: 2px solid #ec4899; border-radius: 12px; padding: 1rem; box-shadow: 0 10px 40px rgba(0,0,0,0.6);backdrop-filter: blur(10px); width: 340px;">
        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 0.75rem;">
            <h4 id="mini-player-song-title" style="color: var(--light); margin: 0; font-size: 0.95rem; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; flex: 1;"></h4>
            <button id="music-player-maximize" style="background: rgba(236,72,153,0.1); border: 1px solid rgba(236,72,153,0.3); color: #ec4899; border-radius: 6px; padding: 0.4rem 0.6rem; cursor: pointer; margin-left: 0.5rem;">
                <i class="fas fa-expand"></i>
            </button>
        </div>
        <p id="mini-player-artist" style="color: #ec4899; font-size: 0.85rem; margin: 0 0 0.75rem 0; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;"></p>
        
        <!-- Mini Progress Bar -->
        <div class="audio-progress-bar" id="mini-progress-bar" style="width:100%; height:4px;background: rgba(255,255,255,0.12); border-radius:2px; cursor:pointer; overflow:hidden; margin-bottom: 0.5rem;">
            <div class="audio-progress-fill" id="mini-progress-fill" style="height:100%; width:0%;background: linear-gradient(90deg, #ec4899, #a855f7);"></div>
        </div>
        
        <!-- Mini Time Display -->
        <div style="display:flex; justify-content:space-between; color:#9ca3af; font-size:0.75rem; margin-bottom:0.75rem;">
            <span id="mini-current-time">0:00</span>
            <span id="mini-total-time">0:00</span>
        </div>
        
        <!-- Mini Controls -->
        <div style="display:flex; justify-content:center; align-items:center; gap:0.75rem;">
            <button class="audio-control-btn" id="mini-prev-track-btn" style="background: rgba(236,72,153,0.1); border:1px solid rgba(236,72,153,0.3); color:#ec4899; border-radius:50%; width:36px; height:36px; display:flex; align-items:center; justify-content:center; font-size:0.85rem;"><i class="fas fa-step-backward"></i></button>
            <button class="audio-control-btn" id="mini-backward-btn" style="background: rgba(236,72,153,0.1); border:1px solid rgba(236,72,153,0.3); color:#ec4899; border-radius:50%; width:36px; height:36px; display:flex; align-items:center; justify-content:center; font-size:0.85rem;"><i class="fas fa-backward"></i></button>
            <button class="audio-control-btn" id="mini-play-pause-btn" style="background: linear-gradient(135deg, #ec4899, #a855f7); color:white; border:none; border-radius:50%; width:44px; height:44px; display:flex; align-items:center; justify-content:center; font-size:1rem;"><i class="fas fa-play"></i></button>
            <button class="audio-control-btn" id="mini-forward-btn" style="background: rgba(236,72,153,0.1); border:1px solid rgba(236,72,153,0.3); color:#ec4899; border-radius:50%; width:36px; height:36px; display:flex; align-items:center; justify-content:center; font-size:0.85rem;"><i class="fas fa-forward"></i></button>
            <button class="audio-control-btn" id="mini-next-track-btn" style="background: rgba(236,72,153,0.1); border:1px solid rgba(236,72,153,0.3); color:#ec4899; border-radius:50%; width:36px; height:36px; display:flex; align-items:center; justify-content:center; font-size:0.85rem;"><i class="fas fa-step-forward"></i></button>
        </div>
    </div>

    <!-- Playlist Chooser Modal -->
    <div id="music-playlist-chooser" class="books-reader-modal" style="display:none;background: rgba(0,0,0,0.7);backdrop-filter: blur(6px);">
        <div class="books-reader-content" style="max-width:520px; width:90%; border:1px solid rgba(56,189,248,0.35); border-radius:14px; overflow:hidden;">
            <div class="books-reader-header">
                <button id="playlist-chooser-back" class="books-reader-back-btn">
                    <i class="fas fa-arrow-left"></i>
                   back
                </button>
                <h3>Add to Playlist</h3>
            </div>
            <div style="padding:1rem; display:flex; flex-direction:column; gap:0.75rem;">
                <div style="display:flex; gap:0.5rem;">
                    <input id="playlist-chooser-new-name" placeholder="New playlist name" style="flex:1; padding:0.6rem 0.8rem; border-radius:8px;background:var(--surface); border:1px solid var(--border); color:var(--light);" />
                    <button id="playlist-chooser-create" class="action-btn"><i class="fas fa-plus"></i><span>Create</span></button>
                </div>
                <div id="playlist-chooser-empty" class="books-empty" style="display:none; margin:0;">
                    <div class="books-empty-icon"><i class="fas fa-list"></i></div>
                    <h3>No playlists yet</h3>
                    <p>Create one above, then add your track.</p>
                </div>
                <div id="playlist-chooser-list" class="books-results-grid" style="grid-template-columns: 1fr; gap:0.5rem;"></div>
            </div>
        </div>
    </div>
    <!-- Genres Page -->
    <div id="genresPage" style="display: none;">
        <h2 class="section-title">
            <i class="fas fa-layer-group"></i> Genres
        </h2>
        <div class="genre-grid" id="genresGrid">
            <!-- Genre boxes will be loaded here -->
        </div>
        <div class="loading" id="genresLoading" style="display:none;">
            <i class="fas fa-spinner"></i> Loading genres...
        </div>
    </div>

    <!-- Genre Details Page -->
    <div id="genreDetailsPage" style="display: none;">
        <div class="genre-header">
            <h2 class="section-title" id="genreHeaderTitle">
                <i class="fas fa-tags"></i> <span id="genreTitle">Genre</span>
            </h2>
            <div class="genre-controls">
                <button class="toggle-btn" id="toggleMovies">Movies</button>
                <button class="toggle-btn" id="toggleTV">TV Shows</button>
            </div>
        </div>
        <div class="genre-results-grid" id="genreResultsGrid">
            <!-- Genre media items will be loaded here -->
        </div>
        <div class="loading" id="genreLoadingIndicator" style="display:none;">
            <i class="fas fa-spinner"></i> Loading more...
        </div>
        <div class="loading" id="genreEmptyMessage" style="display:none;">
            <i class="fas fa-info-circle"></i> No results found for this selection.
        </div>
    </div>

    <!-- Catalogs Page -->
    <div id="catalogsPage" style="display: none;">
        <h2 class="section-title">
            <i class="fas fa-th-large"></i> Addon Catalogs
        </h2>
        <div id="catalogsGrid" class="genre-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 1rem; padding: 1rem;">
            <div class="loading">
                <i class="fas fa-spinner fa-spin"></i> Loading catalogs...
            </div>
        </div>
    </div>

    <!-- Catalog Browse Page -->
    <div id="catalogBrowsePage" style="display: none;">
        <div class="page-header-enhanced">
            <button class="back-btn" id="catalogBackBtn" style="position: absolute; left: 1rem; top: 1rem;">
                <i class="fas fa-arrow-left"></i> Back
            </button>
            <div class="page-title-section">
                <h2 class="section-title" id="catalogBrowseTitle">
                    <i class="fas fa-th"></i> <span>Catalog</span>
                </h2>
            </div>
        </div>
        
        <div class="movies-grid" id="catalogBrowseGrid">
            <!-- Catalog items will be loaded here -->
        </div>
        <div class="loading" id="catalogBrowseLoading">
            <i class="fas fa-spinner fa-spin"></i> Loading catalog...
        </div>
    </div>

    <!-- My List Page -->
    <div id="myListPage" style="display: none;">
        <div class="page-header-enhanced">
            <div class="page-title-section">
                <h2 class="section-title">
                    <i class="fas fa-heart"></i> <span>My List</span>
                </h2>
                <p class="page-subtitle">Your personal collection of movies and shows</p>
            </div>
            <div class="page-actions">
                <button class="action-btn" id="clearMyListBtn">
                    <i class="fas fa-trash"></i>
                    <span>Clear All</span>
                </button>
            </div>
        </div>
        
        <div class="movies-grid" id="myListGrid">
            <!-- My list items will be loaded here -->
        </div>
        <div class="loading" id="myListLoading" style="display:none;">
            <i class="fas fa-spinner"></i> Loading your list...
        </div>
        <div class="loading" id="myListEmpty" style="display:none;">
            <i class="fas fa-heart-broken"></i> Your list is empty. Start adding movies and shows!
        </div>
    </div>

    <!-- Done Watching Page -->
    <div id="doneWatchingPage" style="display: none;">
        <div class="page-header-enhanced">
            <div class="page-title-section">
                <h2 class="section-title">
                    <i class="fas fa-check-circle"></i> <span>Done Watching</span>
                </h2>
                <p class="page-subtitle">Movies and shows you've finished watching</p>
            </div>
            <div class="page-actions">
                <button class="action-btn" id="clearDoneWatchingBtn">
                    <i class="fas fa-trash"></i>
                    <span>Clear All</span>
                </button>
            </div>
        </div>
        
        <div class="movies-grid" id="doneWatchingGrid">
            <!-- Done watching items will be loaded here -->
        </div>
        <div class="loading" id="doneWatchingLoading" style="display:none;">
            <i class="fas fa-spinner"></i> Loading your completed items...
        </div>
        <div class="loading" id="doneWatchingEmpty" style="display:none;">
            <i class="fas fa-check-circle"></i> No completed items yet. Mark movies and shows as done when you finish watching!
        </div>
    </div>

    <!-- Trakt Page -->
    <div id="trakt-page" style="display: none;">
        <div class="page-header-enhanced">
            <div class="page-title-section">
                <h2 class="section-title">
                    <i class="fas fa-tv" style="color: #ed1c24;"></i> <span>Trakt Integration</span>
                </h2>
                <p class="page-subtitle">Sync your watching activity with Trakt.tv</p>
            </div>
        </div>

        <div class="trakt-container">
            <!-- Connection Status Card -->
            <div class="trakt-card trakt-status-card">
                <div class="trakt-card-header">
                    <h3><i class="fas fa-wifi"></i> Connection Status</h3>
                </div>
                <div class="trakt-card-body">
                    <div id="traktPageNotConnected" class="trakt-status-section">
                        <div id="traktStatusIndicator" class="trakt-status-indicator disconnected">
                            <i class="fas fa-times-circle"></i>
                            <span>Not Connected</span>
                        </div>
                        <p id="traktStatusDescription" class="trakt-description">
                            Connect your Trakt.tv account to automatically track your watching activity, 
                            sync progress, and manage your watchlist.
                        </p>
                        <div id="traktStatusActions">
                            <button id="traktAuthenticateBtn" class="trakt-btn trakt-btn-primary">
                                <i class="fas fa-link"></i>Connect to Trakt
                            </button>
                        </div>
                    </div>

                    <div id="traktPageConnected" class="trakt-status-section" style="display: none;">
                        <div class="trakt-status-indicator connected">
                            <i class="fas fa-check-circle"></i>
                            <span>Connected as <strong id="traktPageUsername">User</strong></span>
                        </div>
                        <p class="trakt-description">
                            Your account is connected and actively syncing. All your watching activity 
                            is being tracked automatically.
                        </p>
                        <div class="trakt-user-actions">
                            <button class="trakt-btn trakt-btn-secondary" id="traktPageDisconnect">
                                <i class="fas fa-sign-out-alt"></i> Disconnect
                            </button>
                            <button class="trakt-btn trakt-btn-info" id="traktPageRefresh">
                                <i class="fas fa-sync-alt"></i> Refresh Status
                            </button>
                            <button class="trakt-btn trakt-btn-primary" id="traktPageResyncLibrary">
                                <i class="fas fa-cloud-download-alt"></i> Re-sync Library
                            </button>
                            <button class="trakt-btn trakt-btn-info" id="traktPageStats">
                                <i class="fas fa-chart-bar"></i> View Statistics
                            </button>
                        </div>
                    </div>

                    <!-- Device Code Panel -->
                    <div id="traktDeviceCodePanel" class="trakt-device-code" style="display: none;">
                        <div class="trakt-code-header">
                            <h4><i class="fas fa-mobile-alt"></i> Device Authorization</h4>
                        </div>
                        <div class="trakt-code-content">
                            <div class="trakt-code-display">
                                <label>Device Code:</label>
                                <div class="trakt-code-value">
                                    <span id="traktPageUserCode">----</span>
                                    <button id="traktCopyCodeBtn" class="trakt-copy-btn">
                                        <i class="fas fa-copy"></i>
                                    </button>
                                </div>
                                <label>Visit URL:</label>
                                <div class="trakt-code-value">
                                    <span id="traktPageVerificationUrl">https://trakt.tv/activate</span>
                                </div>
                            </div>
                            <div class="trakt-verify-section">
                                <p>Visit the URL above and enter the device code</p>
                                <div class="trakt-verify-actions">
                                    <button id="traktOpenUrlBtn" class="trakt-btn trakt-btn-primary">
                                        <i class="fas fa-external-link-alt"></i> Open Trakt URL
                                    </button>
                                    <button id="traktVerifyDeviceBtn" class="trakt-btn trakt-btn-secondary">
                                        <i class="fas fa-check"></i> Verify Code
                                    </button>
                                </div>
                                <div id="traktDeviceCodeStatus" class="trakt-status-message">
                                    <span>Waiting for authorization...</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Quick Actions Grid -->
            <div class="trakt-actions-grid">
                <div class="trakt-card trakt-action-card" data-action="watchlist">
                    <div class="trakt-action-icon">
                        <i class="fas fa-list"></i>
                    </div>
                    <div class="trakt-action-content">
                        <h4>Your Watchlist</h4>
                        <p>View and manage your Trakt watchlist</p>
                        <span class="trakt-action-count">0</span>
                    </div>
                </div>

                <div class="trakt-card trakt-action-card" data-action="history">
                    <div class="trakt-action-icon">
                        <i class="fas fa-history"></i>
                    </div>
                    <div class="trakt-action-content">
                        <h4>Watch History</h4>
                        <p>See your recently watched content</p>
                        <span class="trakt-action-count">0</span>
                    </div>
                </div>

                <div class="trakt-card trakt-action-card" data-action="collection">
                    <div class="trakt-action-icon">
                        <i class="fas fa-collection"></i>
                    </div>
                    <div class="trakt-action-content">
                        <h4>Collection</h4>
                        <p>Your collected movies and shows</p>
                        <span class="trakt-action-count">0</span>
                    </div>
                </div>

                <div class="trakt-card trakt-action-card" data-action="ratings">
                    <div class="trakt-action-icon">
                        <i class="fas fa-star"></i>
                    </div>
                    <div class="trakt-action-content">
                        <h4>Ratings</h4>
                        <p>Your rated content</p>
                        <span class="trakt-action-count">0</span>
                    </div>
                </div>
            </div>

            <!-- Scrobbling Settings Card -->
            <div class="trakt-card">
                <div class="trakt-card-header">
                    <h3><i class="fas fa-play-circle"></i> Scrobbling Settings</h3>
                </div>
                <div class="trakt-card-body">
                    <div class="trakt-settings-grid">
                        <div class="trakt-setting-item">
                            <div class="trakt-setting-main">
                                <label class="trakt-toggle">
                                    <input type="checkbox" id="traktPageAutoScrobble" checked>
                                    <span class="trakt-toggle-slider"></span>
                                </label>
                                <div class="trakt-setting-content">
                                    <h4>Auto-Track Watching</h4>
                                    <p>Automatically track movies and shows you watch</p>
                                </div>
                            </div>
                        </div>

                        <div class="trakt-setting-item">
                            <div class="trakt-setting-main">
                                <label class="trakt-toggle">
                                    <input type="checkbox" id="traktPageScrobbleProgress" checked>
                                    <span class="trakt-toggle-slider"></span>
                                </label>
                                <div class="trakt-setting-content">
                                    <h4>Sync Progress</h4>
                                    <p>Keep your watch progress synchronized in real-time</p>
                                </div>
                            </div>
                        </div>

                        <div class="trakt-setting-item">
                            <div class="trakt-setting-main">
                                <label class="trakt-toggle">
                                    <input type="checkbox" id="traktPageWatchlistSync" checked>
                                    <span class="trakt-toggle-slider"></span>
                                </label>
                                <div class="trakt-setting-content">
                                    <h4>Watchlist Integration</h4>
                                    <p>Show Trakt watchlist items in search results</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recent Activity -->
            <div class="trakt-card" id="traktRecentActivity" style="display: none;">
                <div class="trakt-card-header">
                    <h3><i class="fas fa-clock"></i> Recent Activity</h3>
                </div>
                <div class="trakt-card-body">
                    <div class="trakt-activity-list" id="traktActivityList">
                        <!-- Activity items will be loaded here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Settings Page -->
    <div id="settings-page" style="display: none; position: relative;">
        <div class="settings-page-container" style="position: relative;">
            <!-- Floating Save Button - Inside settings page -->
            <button id="floatingSaveSettings" onclick="document.getElementById('saveSettingsPage').click();" style="position: absolute; top: 15px; right: 20px; z-index: 100; padding: 12px 24px; font-size: 15px; font-weight: 700; background: linear-gradient(135deg, #10b981, #059669); color: white; border: none; border-radius: 10px; cursor: pointer; display: flex; align-items: center; gap: 8px; box-shadow: 0 4px 15px rgba(16, 185, 129, 0.5);">
                <i class="fas fa-save"></i> 
                <span>Save Settings</span>
            </button>
            <div class="page-header-enhanced">
                <h2 class="section-title">Settings</h2>
            </div>
            
            <div class="settings-tabs">
                <button class="settings-tab active" data-section="streaming">Streaming</button>
                <button class="settings-tab" data-section="debrid">Debrid</button>
                <button class="settings-tab" data-section="nodempv" id="nodempvTab">Player</button>
                <button class="settings-tab" data-section="engine">Engine</button>
                <button class="settings-tab" data-section="ui">User Interface</button>
                <button class="settings-tab" data-section="trakt">Trakt Integration</button>
                <button class="settings-tab" data-section="addons">Addon Manager</button>
                <button class="settings-tab" data-section="aiostreams">AIOStreams</button>
            </div>

            <div class="settings-sections">
                <!-- Streaming Section -->
                <div id="streamingContent" class="settings-section active">
                    <div class="settings-card">
                        <div class="settings-card-header">
                            <h3><i class="fas fa-server"></i> Jackett Configuration</h3>
                        </div>
                        <div class="settings-card-body">
                            <div class="current-api-key" id="currentApiKey">
                                No API key configured
                            </div>
                            <div class="form-group">
                                <label for="newApiKey">New API Key:</label>
                                <input type="text" id="newApiKey" placeholder="Enter new Jackett API key..." />
                            </div>
                            <div class="form-group">
                                <label for="jackettUrl">Jackett Base URL:</label>
                                <input type="text" id="jackettUrl" placeholder="http://127.0.0.1:9117/api/v2.0/indexers/all/results/torznab" />
                                <small style="color:var(--secondary); font-size:0.85rem; margin-top:0.25rem; display:block;">Default: http://127.0.0.1:9117/api/v2.0/indexers/all/results/torznab</small>
                            </div>
                            <button id="jackettTutorialBtn" class="api-btn" style="background: white; color: #1a1a1a; padding: 0.5rem 1rem; font-size: 0.9rem; margin-top: 1rem; font-weight: 600;">
                                Video Tutorial
                            </button>
                        </div>
                    </div>
                    
                    
                    
                    <div class="settings-card">
                        <div class="settings-card-header">
                            <h3><i class="fas fa-play-circle"></i> Streaming Mode</h3>
                        </div>
                        <div class="settings-card-body">
                            <div class="checkbox-group">
                                <input type="checkbox" id="useStreamingServersToggle" />
                                <label for="useStreamingServersToggle">Use Streaming Servers instead of Torrents</label>
                            </div>
                            <div style="margin-top:0.5rem; color:#10b981; font-size:0.9rem;">
                                Stream directly from web servers (faster startup, no downloads)
                            </div>
                            <div style="margin-top:0.25rem; color:#9ca3af; font-size:0.85rem;">
                                When enabled, movies/shows will stream from online servers instead of torrent files
                            </div>
                        </div>
                    </div>
                    
                    <div class="settings-card">
                        <div class="settings-card-header">
                            <h3><i class="fas fa-hdd"></i> Cache & Storage</h3>
                        </div>
                        <div class="settings-card-body">
                            <div class="form-group">
                                <label for="cacheLocation">Cache Location:</label>
                                <div style="display:flex; gap:0.5rem; align-items:center;">
                                    <input type="text" id="cacheLocation" readonly placeholder="System default temp folder" style="flex:1;" />
                                    <button class="api-btn" id="selectCacheBtn" style="background:#0d6efd; color:#fff; white-space:nowrap;">
                                        <i class="fas fa-folder-open"></i> Browse
                                    </button>
                                </div>
                                <small style="color:var(--secondary); font-size:0.85rem; margin-top:0.25rem; display:block;">
                                    <i class="fas fa-info-circle"></i> Location where WebTorrent streams and subtitles are cached
                                </small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="settings-card">
                        <div class="settings-card-header">
                            <h3><i class="fas fa-stream" style="color: #667eea;"></i> Nuvio Configuration</h3>
                        </div>
                        <div class="settings-card-body">
                            <div style="margin-bottom: 1rem; color: var(--secondary); font-size: 0.9rem;">
                                <i class="fas fa-info-circle"></i>
                                Configure your Febbox token for Nuvio streaming (ShowBox). A default token is provided, but you can use your own.
                            </div>
                            
                            <div class="form-group">
                                <label for="febboxTokenInput">
                                    Febbox JWT Token (Optional)
                                </label>
                                <input 
                                    type="text" 
                                    id="febboxTokenInput" 
                                    placeholder="Leave empty to use default token or paste your Febbox JWT token here"
                                    style="font-family: monospace;"
                                />
                            </div>
                            
                            <button id="saveFebboxToken" class="btn" style="width: 100%;">
                                <i class="fas fa-save"></i> Save Token
                            </button>
                            
                            <div style="margin-top: 1rem; padding: 0.75rem;background: rgba(103, 126, 234, 0.1); border-left: 3px solid var(--secondary); border-radius: 4px; font-size: 0.85rem;">
                                <i class="fas fa-check-circle" style="color: var(--secondary);"></i> Default token is active. You can continue using Nuvio without adding your own token.
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Debrid Section -->
                <div id="debridContent" class="settings-section">
                    <div class="settings-card">
                        <div class="settings-card-header">
                            <h3><i class="fas fa-cloud"></i> Debrid Services (Cloud Cache)</h3>
                        </div>
                        <div class="settings-card-body" id="debridSection">
                            <div class="checkbox-group">
                                <input type="checkbox" id="useDebridToggle" />
                                <label for="useDebridToggle">Use Debrid</label>
                            </div>
                            
                            <div class="form-group">
                                <div style="display:flex; gap:0.75rem; align-items:center; flex-wrap: wrap;">
                                    <label for="debridProvider">Provider:</label>
                                    <select id="debridProvider" style="min-width:220px; max-width:260px;">
                                        <option value="realdebrid">Real-Debrid</option>
                                        <option value="alldebrid">AllDebrid</option>
                                        <option value="torbox">TorBox</option>
                                        <option value="premiumize">Premiumize</option>
                                    </select>
                                    <span id="debridStatus" style="font-size:0.9rem; opacity:0.85;">Not logged in</span>
                                </div>
                            </div>
                            
                            <!-- real-debrid Section -->
                            <div class="form-group" id="rdClientIdGroup">
                                <label for="rdClientId">Real-Debrid Client ID (device flow):</label>
                                <input type="text" id="rdClientId" placeholder="Enter your RD Client ID (e.g., XXXXXXXXXXXXX)" />
                            </div>
                            
                            <div id="rdButtons" style="display:flex; gap:0.5rem; flex-wrap: wrap; align-items:center;">
                                <button class="api-btn" id="rdDeviceLogin" style="background:#198754; color:#fff;">
                                    <i class="fas fa-sign-in-alt"></i> Login with Real-Debrid
                                </button>
                                <small style="opacity:0.85;">No password needed. Authenticate on real-debrid.com using a short code.</small>
                            </div>
                            
                            <div id="rdCodePanel" style="display:none; margin-top:0.5rem; padding:0.75rem;background:rgba(0,0,0,0.35); border:1px solid rgba(255,255,255,0.1); border-radius:8px;">
                                <div style="display:flex; align-items:center; gap:0.5rem; flex-wrap:wrap;">
                                    <div>Code:</div>
                                    <div id="rdUserCode" style="font-family:monospace; font-weight:800;background:rgba(255,255,255,0.1); padding:0.25rem 0.5rem; border-radius:6px;">----</div>
                                    <button class="api-btn" id="rdCopyCode" style="padding:0.4rem 0.6rem;background:#0d6efd; color:#fff;"><i class="fas fa-copy"></i> Copy</button>
                                </div>
                                <div style="margin-top:0.5rem; display:flex; align-items:center; gap:0.5rem; flex-wrap:wrap;">
                                    <div>Verify at:</div>
                                    <a id="rdVerifyUrl" href="#" target="_blank" style="color:#0d6efd; text-decoration:underline;">https://real-debrid.com/device</a>
                                    <button class="api-btn" id="rdOpenVerify" style="padding:0.4rem 0.6rem;background:#0d6efd; color:#fff;"><i class="fas fa-external-link-alt"></i> Open</button>
                                    <span id="rdLoginStatus" style="margin-left:auto; font-size:0.9rem; opacity:0.9;">Waiting for approval...</span>
                                    <button class="api-btn api-btn-secondary" id="rdCancelLogin"><i class="fas fa-times"></i> Cancel</button>
                                </div>
                            </div>
                            
                            <div class="form-group" id="rdTokenGroup">
                                <label for="debridToken">Real-Debrid Token (temporary MVP):</label>
                                <input type="password" id="debridToken" placeholder="Paste RD token..." />
                            </div>
                            
                            <div id="rdTokenButtons" style="display:flex; gap:0.5rem; flex-wrap: wrap;">
                                <button class="api-btn" id="saveDebridToken" style="background:#0d6efd; color:#fff;">
                                    <i class="fas fa-key"></i> Save Token
                                </button>
                                <button class="api-btn api-btn-secondary" id="clearDebridToken">
                                    <i class="fas fa-sign-out-alt"></i> Logout
                                </button>
                            </div>
                            
                            <div style="margin-top:0.25rem; color:#ffc107; font-size:0.9rem;">Your token is stored locally and never exposed to websites.</div>

                            <!-- AllDebrid PIN Login UI -->
                            <div id="adSection" style="display:none; margin-top:1rem; padding:1rem; border:1px solid rgba(255,255,255,0.15); border-radius:8px;background: rgba(255,255,255,0.05);">
                                <div style="display:flex; gap:0.5rem; align-items:center; flex-wrap:wrap;">
                                    <button class="api-btn" id="adStartPin" style="background:#198754; color:#fff;"><i class="fas fa-sign-in-alt"></i> Login with AllDebrid (PIN)</button>
                                    <small style="opacity:0.85;">Authenticate on alldebrid.com/pin with the code shown.</small>
                                </div>
                                <div id="adPinPanel" style="display:none; margin-top:0.5rem; padding:0.75rem;background:rgba(0,0,0,0.35); border:1px solid rgba(255,255,255,0.1); border-radius:8px;">
                                    <div style="display:flex; align-items:center; gap:0.5rem; flex-wrap:wrap;">
                                        <div>PIN:</div>
                                        <div id="adPinCode" style="font-family:monospace; font-weight:800;background:rgba(255,255,255,0.1); padding:0.25rem 0.5rem; border-radius:6px;">----</div>
                                        <button class="api-btn" id="adCopyPin" style="padding:0.4rem 0.6rem;background:#0d6efd; color:#fff;"><i class="fas fa-copy"></i> Copy</button>
                                    </div>
                                    <div style="margin-top:0.5rem; display:flex; align-items:center; gap:0.5rem; flex-wrap:wrap;">
                                        <div>Open:</div>
                                        <a id="adUserUrl" href="https://alldebrid.com/pin/" target="_blank" style="color:#0d6efd; text-decoration:underline;">https://alldebrid.com/pin/</a>
                                        <button class="api-btn" id="adOpenUserUrl" style="padding:0.4rem 0.6rem;background:#0d6efd; color:#fff;"><i class="fas fa-external-link-alt"></i> Open</button>
                                        <span id="adLoginStatus" style="margin-left:auto; font-size:0.9rem; opacity:0.9;">Waiting…</span>
                                        <button class="api-btn api-btn-secondary" id="adCancelPin"><i class="fas fa-times"></i> Cancel</button>
                                    </div>
                                </div>
                                <div class="form-group" style="margin-top:0.75rem;">
                                    <label for="adApiKey">AllDebrid API Key (optional/manual):</label>
                                    <input type="password" id="adApiKey" placeholder="Paste AD API key..." />
                                </div>
                                <div style="display:flex; gap:0.5rem; flex-wrap: wrap;">
                                    <button class="api-btn" id="adSaveApiKey" style="background:#0d6efd; color:#fff;"><i class="fas fa-key"></i> Save API Key</button>
                                    <button class="api-btn api-btn-secondary" id="adClearApiKey"><i class="fas fa-sign-out-alt"></i> Logout</button>
                                </div>
                            </div>

                            <!-- TorBox Auth (token) -->
                            <div id="tbSection" style="display:none; margin-top:1rem; padding:1rem; border:1px solid rgba(255,255,255,0.15); border-radius:8px;background: rgba(255,255,255,0.05);">
                                <div class="form-group">
                                    <label for="tbToken">TorBox Token (temporary):</label>
                                    <input type="password" id="tbToken" placeholder="Paste TorBox token..." />
                                </div>
                                <div style="display:flex; gap:0.5rem; flex-wrap: wrap;">
                                    <button class="api-btn" id="tbSaveToken" style="background:#0d6efd; color:#fff;"><i class="fas fa-key"></i> Save Token</button>
                                    <button class="api-btn api-btn-secondary" id="tbClearToken"><i class="fas fa-sign-out-alt"></i> Logout</button>
                                </div>
                                <div style="margin-top:0.25rem; color:#ffc107; font-size:0.9rem;">Token stored locally.</div>
                            </div>

                            <!-- Premiumize Auth (API Key) -->
                            <div id="pmSection" style="display:none; margin-top:1rem; padding:1px solid rgba(255,255,255,0.15); border-radius:8px;background: rgba(255,255,255,0.05);">
                                <div class="form-group">
                                    <label for="pmApiKey">Premiumize API Key:</label>
                                    <input type="password" id="pmApiKey" placeholder="Enter your Premiumize API key..." />
                                </div>
                                <div style="display:flex; gap:0.5rem; flex-wrap: wrap;">
                                    <button class="api-btn" id="pmSaveApiKey" style="background:#0d6efd; color:#fff;"><i class="fas fa-key"></i> Save API Key</button>
                                    <button class="api-btn api-btn-secondary" id="pmClearApiKey"><i class="fas fa-sign-out-alt"></i> Logout</button>
                                </div>
                                <div style="margin-top:0.25rem; color:#ffc107; font-size:0.9rem;">
                                    Get your API key from <a href="https://www.premiumize.me/account" target="_blank" style="color:#0d6efd; text-decoration:underline;">premiumize.me/account</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Player Settings Section (All Platforms) -->
                <div id="nodempvContent" class="settings-section">
                    <div class="settings-card">
                        <div class="settings-card-header">
                            <h3><i class="fas fa-play-circle" style="color: #f97316;"></i> Player Settings</h3>
                        </div>
                        <div class="settings-card-body">
                            <div class="form-group">
                                <label for="playerTypeSelect">Video Player</label>
                                <select id="playerTypeSelect">
                                    <option value="builtin">Built-in HTML5 Player (Default)</option>
                                    <option value="playtorrio">PlayTorrio Player</option>
                                    <option value="nodempv" id="nodempvOption">Node MPV Player</option>
                                </select>
                                <div style="margin-top:0.5rem; color:var(--gray); font-size:0.85rem;">
                                    <i class="fas fa-info-circle"></i> Choose your preferred video player.
                                </div>
                            </div>
                            
                            <!-- MPV Path Section (Windows Only) -->
                            <div id="mpvPathSection" style="display:none; margin-top:1rem;">
                                <div class="form-group">
                                    <label for="mpvPathInput">Custom MPV Path (optional)</label>
                                    <div style="display:flex; gap:0.5rem;">
                                        <input type="text" id="mpvPathInput" placeholder="Leave empty to use global MPV" style="flex:1;" />
                                        <button class="api-btn" id="browseMpvPathBtn" style="background:var(--gray-dark);">
                                            <i class="fas fa-folder-open"></i> Browse
                                        </button>
                                    </div>
                                    <div style="margin-top:0.25rem; color:var(--gray); font-size:0.8rem;">
                                        Path to mpv.exe (e.g., C:\mpv\mpv.exe)
                                    </div>
                                </div>
                                
                                <div style="margin-top:0.75rem; padding:0.75rem;background:rgba(249,115,22,0.1); border-left:3px solid #f97316; border-radius:4px; font-size:0.85rem;">
                                    <i class="fas fa-download" style="color:#f97316;"></i> 
                                    <a href="#" id="downloadMpvLink" style="color:#f97316; text-decoration:underline;">Download MPV</a> if not installed.
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Torrent Engine Section -->
                <div id="engineContent" class="settings-section">
                    <div class="settings-card">
                        <div class="settings-card-header">
                            <h3><i class="fas fa-sync-alt" style="color: #06b6d4;"></i> Torrent Engine</h3>
                        </div>
                        <div class="settings-card-body">
                            <div class="form-group">
                                <label for="torrentEngineSelect">Engine Type</label>
                                <select id="torrentEngineSelect">
                                    <option value="stremio">Stremio Engine (Default)</option>
                                    <option value="webtorrent">WebTorrent</option>
                                    <option value="torrentstream">TorrentStream</option>
                                    <option value="hybrid">Hybrid Mode</option>
                                </select>
                                <div style="margin-top:0.5rem; color:var(--gray); font-size:0.8rem;">
                                    <i class="fas fa-info-circle"></i> Choose your preferred torrent streaming engine.
                                </div>
                            </div>
                            
                            <div id="engineInstancesContainer" class="form-group" style="display:none; margin-top:1.25rem;">
                                <label for="engineInstancesSlider">
                                    <i class="fas fa-layer-group" style="color:#06b6d4;"></i> 
                                    Engine Instances: <span id="engineInstanceLabel" style="color:#06b6d4; font-weight:bold;">1</span>
                                </label>
                                <input type="range" id="engineInstancesSlider" min="1" max="3" value="1" style="width:100%; accent-color:#06b6d4; margin-top:0.5rem;" />
                                <div style="display:flex; justify-content:space-between; color:var(--gray); font-size:0.75rem; margin-top:0.25rem;">
                                    <span>1 (Light)</span>
                                    <span>2 (Balanced)</span>
                                    <span>3 (Maximum)</span>
                                </div>
                                <div style="margin-top:0.5rem; color:var(--gray); font-size:0.8rem;">
                                    <i class="fas fa-bolt"></i> More instances = more peers = faster downloads. Uses more resources.
                                </div>
                            </div>
                            
                            <div id="engineInfoBox" style="margin-top:1.25rem; padding:1rem;background:rgba(6,182,212,0.1); border-left:4px solid #06b6d4; border-radius:6px;">
                                <p id="engineDescription" style="color:#67e8f9; font-size:0.9rem; margin:0; line-height:1.5;">
                                    Stremio's engine provides reliable streaming with built-in transcoding support.
                                </p>
                            </div>
                            
                            <div id="engineStatus" style="margin-top:1rem; padding:0.75rem;background:rgba(34,197,94,0.1); border-radius:6px; display:none;">
                                <span style="color:#4ade80; font-size:0.85rem;">
                                    <i class="fas fa-check-circle"></i> <span id="engineStatusText">Engine ready</span>
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Addon Manager Section -->
                <div id="addonsContent" class="settings-section">
                    <div class="settings-card">
                        <div class="settings-card-header">
                            <h3><i class="fas fa-puzzle-piece" style="color: var(--vlc-orange);"></i> Addon Manager</h3>
                        </div>
                        <div class="settings-card-body">
                            <div style="margin-bottom: 1rem; color: var(--secondary); font-size: 0.9rem;">
                                <i class="fas fa-info-circle"></i> Install Stremio addons to expand content sources.
                            </div>
                            
                            <div class="form-group">
                                <label for="addonManifestUrl">Manifest URL:</label>
                                <div style="display: flex; gap: 0.5rem;">
                                    <input type="text" id="addonManifestUrl" placeholder="https://example.com/manifest.json" style="flex:1;" />
                                    <button class="api-btn" id="installAddonBtn" style="background: var(--success); color: #fff;">
                                        <i class="fas fa-plus"></i> Install
                                    </button>
                                </div>
                            </div>

                            <div style="margin-top: 1rem;">
                                <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Installed Addons:</label>
                                <div id="installedAddonsList" style="display: flex; flex-direction: column; gap: 0.5rem; max-height: 300px; overflow-y: auto; padding-right: 0.5rem;">
                                    <!-- Addons will be injected here -->
                                    <div style="text-align: center; color: var(--gray); padding: 1rem;">Loading addons...</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- AIOStreams Section -->
                <div id="aiostreamsContent" class="settings-section">
                    <div class="settings-card">
                        <div class="settings-card-header">
                            <h3><i class="fas fa-plug"></i> AIOStreams Plugin Installer</h3>
                        </div>

                        <div class="settings-card-body" id="aiostreamsSection">

                            <div style="margin-bottom: 1rem; color: var(--secondary); font-size: 0.9rem;">
                                <i class="fas fa-info-circle"></i>
                                Install additional streaming providers using an AIOStreams manifest URL.
                            </div>

                            <div class="form-group">
                                <label for="manifestUrl">Plugin Manifest URL (Go to https://aiostreams.elfhosted.com/stremio/configure setup the plugin, setup a password, click install, click copy url and paste it here</label>
                                <input 
                                    type="text" 
                                    id="manifestUrl"
                                    placeholder="https://example.com/manifest.json"
                                    style="width:100%; padding:0.65rem;background:rgba(255,255,255,0.05); border:1px solid rgba(255,255,255,0.2); border-radius:6px; color:var(--light); font-family:monospace;"
                                />
                            </div>

                            <button onclick="saveManifest()" class="api-btn" style="background:#0d6efd; color:#fff; width:100%; margin-top:1rem;">
                                <i class="fas fa-save"></i> Save Manifest
                            </button>


                            <div id="manifestSavedBox" style="display:none; margin-top:1rem; padding:0.75rem;background:rgba(103,126,234,0.1); border-left:3px solid var(--secondary); border-radius:4px; font-size:0.85rem;">
                                <i class="fas fa-check-circle" style="color:var(--secondary);"></i> Manifest URL saved locally.
                            </div>

                        </div>
                    </div>
                </div>

                <!-- User Interface Section -->
                <div id="uiContent" class="settings-section">
                    <div class="settings-card">
                        <div class="settings-card-header">
                            <h3><i class="fas fa-desktop"></i> Display Settings</h3>
                        </div>
                        <div class="settings-card-body">
                            <div class="checkbox-group">
                                <input type="checkbox" id="fullscreenToggle" />
                                <label for="fullscreenToggle">
                                    <i class="fas fa-expand-arrows-alt" style="margin-right:0.25rem; color:var(--vlc-orange);"></i>
                                    <strong>Fullscreen Mode</strong>
                                </label>
                            </div>
                            <div style="margin-top:0.25rem; color:var(--secondary); font-size:0.85rem; margin-left:1.85rem;">
                                <i class="fas fa-info-circle"></i> Toggle between fullscreen and windowed mode
                            </div>
                            
                            <div class="radio-group" style="margin-top:1.5rem; padding-top:1rem; border-top:1px solid rgba(255,255,255,0.1);">
                                <label style="display:block; margin-bottom:0.75rem; color:var(--light); font-weight:600;">
                                    UI Mode
                                </label>
                                <div class="radio-option">
                                    <input type="radio" name="uiMode" value="new" id="uiModeNew" checked />
                                    <label for="uiModeNew"><strong>NEW UI</strong> - Modern app-like interface</label>
                                </div>
                                <div class="radio-option">
                                    <input type="radio" name="uiMode" value="old" id="uiModeOld" />
                                    <label for="uiModeOld"><strong>OLD UI</strong> - Classic website layout</label>
                                </div>
                                <div style="margin-top:0.75rem; padding-top:0.75rem; border-top:1px solid rgba(255,255,255,0.05);">
                                    <button onclick="if(window.electronAPI?.setPreferredMode) window.electronAPI.setPreferredMode('basic'); window.location.href='basicmode/index.html'" class="btn btn-outline" style="width:100%; justify-content:center;">
                                        <i class="fas fa-bolt"></i> Switch to Basic Mode
                                    </button>
                                </div>
                                <div style="margin-top:0.5rem; color:var(--secondary); font-size:0.9rem;">
                                    <i class="fas fa-info-circle"></i> Changes will apply immediately after saving
                                </div>
                            </div>
                        </div>
                    </div>


                    <div class="settings-card">
                        <div class="settings-card-header">
                            <h3><i class="fas fa-palette"></i> Theme</h3>
                        </div>
                        <div class="settings-card-body">
                            <div class="form-group">
                                <label for="themeSelector" style="display:block; margin-bottom:0.75rem; color:var(--light); font-weight:600; font-size:1rem;">
                                    <i class="fas fa-palette" style="margin-right:0.5rem; color:var(--vlc-orange);"></i>
                                    Color Theme
                                </label>
                                <select id="themeSelector" style="width:100%; max-width:350px; padding:0.75rem 1rem;background: rgba(255,255,255,0.08); border: 2px solid rgba(255,255,255,0.2); border-radius:10px; color:var(--light); font-size:0.95rem; font-weight:500; cursor:pointer; transition: all 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94), transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1); appearance: none;background-image: url('data:image/svg+xml;charset=UTF-8,%3csvg xmlns=%27http://www.w3.org/2000/svg%27 viewBox=%270 0 24 24%27 fill=%27none%27 stroke=%27rgba(255,255,255,0.6)%27 stroke-width=%272%27 stroke-linecap=%27round%27 stroke-linejoin=%27round%27%3e%3cpolyline points=%276 9 12 15 18 9%27%3e%3c/polyline%3e%3c/svg%3e');background-repeat: no-repeat;background-position: right 0.75rem center;background-size: 1.25rem; padding-right: 2.5rem;">
                                    <option value="default">Default (Purple Dream)</option>
                                    <option value="green-forest">Green Forest</option>
                                    <option value="cyberpunk-neon">Cyberpunk Neon</option>
                                    <option value="ocean-breeze">Ocean Breeze</option>
                                    <option value="cherry-blossom">Cherry Blossom</option>
                                    <option value="midnight-dark">Midnight Dark</option>
                                    <option value="sunset-orange">Sunset Orange</option>
                                </select>
                                <small style="margin-top:0.5rem; color:var(--secondary); font-size:0.85rem; display:block;">
                                    <i class="fas fa-info-circle"></i> Choose your preferred color scheme
                                </small>
                            </div>
                        </div>
                    </div>

                    <div class="settings-card">
                        <div class="settings-card-header">
                            <h3><i class="fab fa-discord"></i> Discord Activity</h3>
                        </div>
                        <div class="settings-card-body">
                            <div class="checkbox-group">
                                <input type="checkbox" id="discordActivityToggle" checked />
                                <label for="discordActivityToggle">
                                    <i class="fab fa-discord" style="margin-right:0.25rem; color:#5865F2;"></i>
                                    <strong>Show Discord Rich Presence</strong>
                                </label>
                            </div>
                            <div style="margin-top:0.5rem; color:#9ca3af; font-size:0.9rem;">
                                <i class="fas fa-info-circle"></i> Display what you're watching on your Discord profile
                            </div>
                        </div>
                    </div>

                    <div class="settings-card">
                        <div class="settings-card-header">
                            <h3><i class="fas fa-ad" style="color: #10b981;"></i> Sponsor</h3>
                        </div>
                        <div class="settings-card-body">
                            <div class="checkbox-group">
                                <input type="checkbox" id="showSponsorToggle" checked />
                                <label for="showSponsorToggle">
                                    <i class="fas fa-heart" style="margin-right:0.25rem; color:#10b981;"></i>
                                    <strong>Show Sponsor Button</strong>
                                </label>
                            </div>
                            <div style="margin-top:0.5rem; color:#9ca3af; font-size:0.9rem;">
                                <i class="fas fa-info-circle"></i> Display the Ace Bet sponsor button in the navigation. Sponsors help keep PlayTorrio free!
                            </div>
                        </div>
                    </div>

                    <div class="settings-card">
                        <div class="settings-card-header">
                            <h3><i class="fas fa-sync-alt"></i> Auto‑Updater</h3>
                        </div>
                        <div class="settings-card-body">
                            <div class="checkbox-group">
                                <input type="checkbox" id="autoUpdateToggle" checked />
                                <label for="autoUpdateToggle">Automatically download and install updates</label>
                            </div>
                            <div style="margin-top:0.5rem; color:#9ca3af; font-size:0.9rem;">
                                When enabled, the app will check for updates on launch and install them when available.
                            </div>
                        </div>
                    </div>

                    <!-- Attribution Card -->
                    <div class="settings-card">
                        <div class="settings-card-header">
                            <h3><i class="fas fa-brush" style="color: var(--vlc-orange);"></i> Icon Attribution</h3>
                        </div>
                        <div class="settings-card-body" style="font-size:0.9rem; line-height:1.5; color:var(--secondary);">
                            <p style="margin:0 0 0.75rem; color:var(--light);"><strong>PlayTorrio App Icon</strong></p>
                            <p style="margin:0 0 0.75rem;">Designed by <strong>Adnan Ahmed</strong>.</p>
                            <p style="margin:0 0 0.5rem;">
                                <i class="fas fa-globe" style="color:var(--vlc-orange);"></i>
                                <a href="https://adnan-ahmed.pages.dev/" target="_blank" style="color:#0d6efd; text-decoration:underline; cursor:pointer;" onclick="event.preventDefault(); if (window.electronAPI?.openExternal) { window.electronAPI.openExternal('https://adnan-ahmed.pages.dev/'); } else { window.open('https://adnan-ahmed.pages.dev/', '_blank'); }">Website</a>
                            </p>
                            <p style="margin:0 0 0.5rem;">
                                <i class="fab fa-github" style="color:var(--vlc-orange);"></i>
                                <a href="https://github.com/ddosintruders" target="_blank" style="color:#0d6efd; text-decoration:underline; cursor:pointer;" onclick="event.preventDefault(); if (window.electronAPI?.openExternal) { window.electronAPI.openExternal('https://github.com/ddosintruders'); } else { window.open('https://github.com/ddosintruders', '_blank'); }">GitHub Profile</a>
                            </p>
                            <p style="margin:0; font-size:0.75rem; opacity:0.8;">Credit preserved per creator request. Thank you Adnan for the visual identity.</p>
                        </div>
                    </div>
                </div>
                
                <!-- Trakt Integration Section -->
                <div id="traktContent" class="settings-section">
                    <div class="settings-card">
                        <div class="settings-card-header">
                            <h3><i class="fas fa-tv" style="color: #ed1c24;"></i> Trakt Connection</h3>
                        </div>
                        <div class="settings-card-body">
                            <div style="margin-bottom: 1rem; color: var(--secondary); font-size: 0.9rem;">
                                <i class="fas fa-info-circle"></i>
                                Sync your watch history, progress, and manage your watchlist with Trakt.tv
                            </div>
                            
                            <div id="traktNotConnected" style="display: block;">
                                <div style="margin-bottom: 1rem;">
                                    <span id="traktStatus" style="color: #dc3545; font-weight: 500;">
                                        <i class="fas fa-times-circle"></i> Not connected
                                    </span>
                                </div>
                                <div style="display: flex; gap: 0.75rem; align-items: center; flex-wrap: wrap;">
                                    <button class="api-btn" id="traktLogin" style="background: #ed1c24; color: #fff;">
                                        <i class="fas fa-sign-in-alt"></i> Connect to Trakt
                                    </button>
                                    <small style="opacity: 0.85;">Authenticate with your Trakt.tv account using a secure device code</small>
                                </div>
                            </div>

                            <div id="traktConnected" style="display: none;">
                                <div style="margin-bottom: 1rem;">
                                    <span id="traktConnectedStatus" style="color: #198754; font-weight: 500;">
                                        <i class="fas fa-check-circle"></i> Connected as <span id="traktUsername">User</span>
                                    </span>
                                </div>
                                <div style="display: flex; gap: 0.75rem; align-items: center; flex-wrap: wrap; margin-bottom: 1rem;">
                                    <button class="api-btn" id="traktViewWatchlist" style="background: #0d6efd; color: #fff;">
                                        <i class="fas fa-list"></i> View Watchlist
                                    </button>
                                    <button class="api-btn" id="traktViewHistory" style="background: #6f42c1; color: #fff;">
                                        <i class="fas fa-history"></i> View History
                                    </button>
                                    <button class="api-btn" id="traktViewStats" style="background: #17a2b8; color: #fff;">
                                        <i class="fas fa-chart-bar"></i> View Stats
                                    </button>
                                </div>
                                <div style="display: flex; gap: 0.75rem; align-items: center; flex-wrap: wrap;">
                                    <button class="api-btn api-btn-secondary" id="traktDisconnect">
                                        <i class="fas fa-sign-out-alt"></i> Disconnect
                                    </button>
                                </div>
                            </div>

                            <!-- Trakt Device Code Panel -->
                            <div id="traktCodePanel" style="display: none; margin-top: 1rem; padding: 0.75rem;background: rgba(0,0,0,0.35); border: 1px solid rgba(255,255,255,0.1); border-radius: 8px;">
                                <div style="display: flex; align-items: center; gap: 0.5rem; flex-wrap: wrap; margin-bottom: 0.5rem;">
                                    <div>Device Code:</div>
                                    <div id="traktUserCode" style="font-family: monospace; font-weight: 800;background: rgba(255,255,255,0.1); padding: 0.25rem 0.5rem; border-radius: 6px;">----</div>
                                    <button class="api-btn" id="traktCopyCode" style="padding: 0.4rem 0.6rem;background: #0d6efd; color: #fff;">
                                        <i class="fas fa-copy"></i> Copy
                                    </button>
                                </div>
                                <div style="display: flex; align-items: center; gap: 0.5rem; flex-wrap: wrap;">
                                    <div>Authorize at:</div>
                                    <a id="traktVerifyUrl" href="#" target="_blank" style="color: #0d6efd; text-decoration: underline;">https://trakt.tv/activate</a>
                                    <button class="api-btn" id="traktOpenVerify" style="padding: 0.4rem 0.6rem;background: #0d6efd; color: #fff;">
                                        <i class="fas fa-external-link-alt"></i> Open
                                    </button>
                                    <span id="traktLoginStatus" style="margin-left: auto; font-size: 0.9rem; opacity: 0.9;">Waiting for authorization…</span>
                                    <button class="api-btn api-btn-secondary" id="traktCancelLogin">
                                        <i class="fas fa-times"></i> Cancel
                                    </button>
                                </div>
                            </div>

                            <!-- Trakt Settings -->
                            <div id="traktSettings" style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid rgba(255,255,255,0.1);">
                                <h4 style="margin-bottom: 0.75rem; color: var(--text-primary);">Scrobbling Settings</h4>
                                <div style="display: flex; flex-direction: column; gap: 0.5rem;">
                                    <label style="display: flex; align-items: center; gap: 0.6rem; cursor: pointer;">
                                        <input type="checkbox" id="traktAutoScrobble" checked />
                                        <span>Automatically track what I watch</span>
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 0.6rem; cursor: pointer;">
                                        <input type="checkbox" id="traktScrobbleProgress" checked />
                                        <span>Sync watch progress</span>
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 0.6rem; cursor: pointer;">
                                        <input type="checkbox" id="traktSyncWatchlist" checked />
                                        <span>Show Trakt watchlist items in search</span>
                                    </label>
                                </div>
                                <div style="margin-top: 0.5rem; color: var(--secondary); font-size: 0.85rem;">
                                    <i class="fas fa-info-circle"></i> Your viewing activity will be automatically synchronized with Trakt.tv
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Hidden save button for the floating button to trigger -->
        <button id="saveSettingsPage" style="display: none;"></button>
        <button id="cancelSettingsPage" style="display: none;"></button>
    </div>

    <!-- Live TV Page -->
    <div id="livetv-page" style="display: none;">
        <div class="page-header-enhanced">
            <div class="page-title-section">
                <h2 class="section-title">
                    <i class="fas fa-broadcast-tower" style="color: #10b981;"></i> <span>Live TV</span>
                </h2>
                <p class="page-subtitle">Watch live sports from around the world</p>
            </div>
        </div>

        <div class="trakt-container">
            <!-- Category Selector and Search -->
            <div class="trakt-card">
                <div class="trakt-card-body">
                    <div class="livetv-category-section" style="display: flex; align-items: center; gap: 1rem; flex-wrap: wrap; margin-bottom: 1rem;">
                        <div id="livetv-source-buttons" style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                            <button class="provider-btn active" data-source="kobra">Kobra</button>
                            <button class="provider-btn" data-source="phoenix">Phoenix</button>
                            <button class="provider-btn" data-source="titan">Titan</button>
                            <button class="provider-btn" data-source="raptor">Raptor</button>
                            <button class="provider-btn" data-source="scorpion">Scorpion</button>
                            <button class="provider-btn" data-source="viper">Viper</button>
                        </div>
                    </div>
                    <div class="livetv-category-section" style="display: flex; align-items: center; gap: 1rem; flex-wrap: wrap;">
                        <div>
                            <label for="livetv-category-select" class="livetv-category-label">
                                <i class="fas fa-filter"></i> Category
                            </label>
                            <select id="livetv-category-select" class="livetv-category-dropdown">
                                <option value="football">⚽ Football</option>
                            </select>
                        </div>
                        <div id="livetv-match-count" style="display: none; align-items: center; gap: 0.75rem; padding: 0.5rem 1rem;background: rgba(17, 24, 39, 0.6);backdrop-filter: blur(10px); border-radius: 20px; border: 1px solid rgba(255, 255, 255, 0.1); font-size: 0.85rem;"></div>
                    </div>
                    <div style="margin-top: 1rem;">
                        <div style="position: relative;">
                            <i class="fas fa-search" style="position: absolute; left: 1rem; top: 50%; transform: translateY(-50%); color: rgba(16,185,129,0.6); font-size: 0.9rem;"></i>
                            <input 
                                type="text" 
                                id="livetv-search-input" 
                                placeholder="Search matches (e.g., Barcelona, Real Madrid, Champions League)..." 
                                style="width: 100%; padding: 0.75rem 1rem 0.75rem 2.75rem; border: 2px solid rgba(16,185,129,0.3); border-radius: 8px;background: rgba(16,185,129,0.05); color: var(--light); font-size: 0.95rem; transition: all 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94), transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);"
                                onfocus="this.style.borderColor='rgba(16,185,129,0.6)'; this.style.background='rgba(16,185,129,0.1)';"
                                onblur="this.style.borderColor='rgba(16,185,129,0.3)'; this.style.background='rgba(16,185,129,0.05)';"
                            >
                        </div>
                    </div>
                </div>
            </div>

            <!-- Matches Grid -->
            <div class="trakt-card">
                <div class="trakt-card-body">
                    <div id="livetv-grid" class="livetv-matches-grid"></div>
                    <div id="livetv-empty" class="livetv-empty" style="display: none;">
                        <i class="fas fa-tv" style="font-size: 3em; opacity: 0.3;"></i>
                        <p>No matches available for this category</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Streams List Modal -->
        <div id="livetv-streams-modal" class="livetv-streams-modal" style="display: none;">
            <div class="livetv-streams-content">
                <div class="livetv-streams-header">
                    <h3 id="livetv-streams-title"></h3>
                    <button id="livetv-streams-close" class="livetv-close-btn">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div id="livetv-streams-list" class="livetv-streams-list"></div>
            </div>
        </div>
    </div>

    <!-- IPTV Page -->
    <div id="iptv-page" style="display: none;">
        <div class="page-header-enhanced">
            <div class="page-title-section">
                <h2 class="section-title">
                    <i class="fas fa-tv" style="color: #3b82f6;"></i> <span>IPTV</span>
                </h2>
                <p class="page-subtitle">Watch live TV channels from around the world</p>
            </div>
            <div class="page-actions" style="display:flex; gap:.5rem; align-items:center;">
                <button id="iptv-custom-btn" class="btn" style="background:linear-gradient(135deg,#3b82f6,#2563eb);color:#fff;border:none;padding:.6rem 1rem;border-radius:8px;font-weight:600;cursor:pointer;">
                    <i class="fas fa-user-lock"></i> Custom IPTV (Xtream Codes)
                </button>
            </div>
        </div>

        <div class="page-content" style="padding: 0; height: calc(100vh - 140px);">
            <iframe 
                id="iptv-iframe" 
                src="https://iptvplaytorrio.pages.dev/" 
                style="width: 100%; height: 100%; border: none; border-radius: 8px;"
                allowfullscreen>
            </iframe>
            <!-- Custom IPTV Inline Browser (replaces iframe when active) -->
            <div id="xtream-inline" style="display:none; width:100%; height:100%;">
                <div style="display:flex; justify-content:space-between; align-items:center; padding:.75rem 1rem; border-bottom:1px solid rgba(255,255,255,.08);background:rgba(0,0,0,.3);">
                    <div style="display:flex; gap:.5rem; align-items:center;">
                        <button class="xtream-tab-btn" data-tab="live" style="background:#1b1b1b;color:#fff;border:1px solid rgba(255,255,255,.15);padding:.45rem .8rem;border-radius:8px;cursor:pointer;">Live</button>
                        <button class="xtream-tab-btn" data-tab="vod" style="background:transparent;color:#ddd;border:1px solid rgba(255,255,255,.15);padding:.45rem .8rem;border-radius:8px;cursor:pointer;">Movies</button>
                        <button class="xtream-tab-btn" data-tab="series" style="background:transparent;color:#ddd;border:1px solid rgba(255,255,255,.15);padding:.45rem .8rem;border-radius:8px;cursor:pointer;">Series</button>
                    </div>
                    <div style="display:flex; gap:.6rem; align-items:center;">
                        <select id="xtream-category-select" size="1" style="background:#1b1b1b;color:#fff;border:1px solid rgba(255,255,255,.15);padding:.45rem .8rem;border-radius:8px;">
                            <option value="">All Categories</option>
                        </select>
                        <input id="xtream-search" placeholder="Search..." style="background:#1b1b1b;color:#fff;border:1px solid rgba(255,255,255,.15);padding:.5rem .8rem;border-radius:8px;min-width:220px;">
                    </div>
                </div>
                <div id="xtream-inline-content" style="width:100%; height:calc(100% - 58px); overflow:auto; padding:1rem;">
                    <div id="xtream-empty" style="display:flex; align-items:center; justify-content:center; height:100%; color:#9ca3af;">No data</div>
                    <div id="xtream-grid" style="display:grid; grid-template-columns:repeat(auto-fill,minmax(220px,1fr)); gap:1rem;"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Xtream Codes Login Modal -->
    <div id="xtream-login-modal" style="display:none; position:fixed; inset:0;background:rgba(0,0,0,.65); z-index:12000; align-items:center; justify-content:center;">
        <div style="width: min(560px, 92vw);background: #121212; color: #fff; border-radius: 16px; border:1px solid rgba(255,255,255,.12); box-shadow:0 20px 50px rgba(0,0,0,.5); overflow:hidden;">
            <div style="display:flex; justify-content:space-between; align-items:center; padding:1rem 1.25rem; border-bottom:1px solid rgba(255,255,255,.08);">
                <h3 style="margin:0; font-size:1.1rem; display:flex; gap:.5rem; align-items:center;"><i class="fas fa-key"></i> Xtream Codes Login</h3>
                <button id="xtream-login-close" style="background:transparent;color:#fff;border:none;font-size:1.25rem;cursor:pointer;">×</button>
            </div>
            <div style="padding:1rem 1.25rem; display:flex; flex-direction:column; gap:.75rem;">
                <label style="font-size:.9rem; color:#ddd;">Server Base URL (e.g. http://example.com:8080)</label>
                <input id="xtream-base-url" placeholder="http://host:port" style="padding:.7rem 1rem; border-radius:10px; border:1px solid rgba(255,255,255,.15);background:#1b1b1b; color:#fff; outline:none;">
                <div style="display:grid; grid-template-columns:1fr 1fr; gap:.75rem;">
                    <div>
                        <label style="font-size:.9rem; color:#ddd;">Username</label>
                        <input id="xtream-username" placeholder="username" style="width:100%; padding:.7rem 1rem; border-radius:10px; border:1px solid rgba(255,255,255,.15);background:#1b1b1b; color:#fff; outline:none;">
                    </div>
                    <div>
                        <label style="font-size:.9rem; color:#ddd;">Password</label>
                        <input id="xtream-password" placeholder="password" type="password" style="width:100%; padding:.7rem 1rem; border-radius:10px; border:1px solid rgba(255,255,255,.15);background:#1b1b1b; color:#fff; outline:none;">
                    </div>
                </div>
                <div style="display:flex; align-items:center; gap:.5rem; margin-top:.25rem;">
                    <input id="xtream-remember" type="checkbox">
                    <label for="xtream-remember" style="color:#bbb;">Remember on this device</label>
                </div>
                <div style="display:flex; justify-content:flex-end; gap:.5rem; margin-top:.75rem;">
                    <button id="xtream-login-cancel" style="background:rgba(255,255,255,.1); color:#fff; border:1px solid rgba(255,255,255,.2); padding:.6rem 1rem; border-radius:8px; cursor:pointer;">Cancel</button>
                    <button id="xtream-login-submit" style="background:linear-gradient(135deg,#10b981,#059669); color:#fff; border:none; padding:.6rem 1rem; border-radius:8px; font-weight:600; cursor:pointer;">
                        <i class="fas fa-sign-in-alt"></i> Login
                    </button>
                </div>
                <div style="display:flex; align-items:center; gap:.5rem; opacity:.8; padding-top:.4rem; border-top:1px dashed rgba(255,255,255,.15); margin-top:.4rem;">
                    <span style="font-size:.85rem; color:#9ca3af;">OR</span>
                </div>
                <label style="font-size:.9rem; color:#ddd;">M3U/M3U8 Playlist URL</label>
                <input id="xtream-m3u-url" placeholder="http://example.com/playlist.m3u or .m3u8" style="padding:.7rem 1rem; border-radius:10px; border:1px solid rgba(255,255,255,.15);background:#1b1b1b; color:#fff; outline:none;">
                <div style="display:flex; justify-content:flex-end; gap:.5rem;">
                    <button id="xtream-m3u-submit" style="background:linear-gradient(135deg,#f59e0b,#b45309); color:#fff; border:none; padding:.6rem 1rem; border-radius:8px; font-weight:600; cursor:pointer;">
                        <i class="fas fa-list"></i> Load Playlist
                    </button>
                </div>
                <!-- Recommended M3U Playlists -->
                <div id="xtream-m3u-recommended" style="margin-top:.5rem;">
                    <div style="font-size:.85rem; color:#9ca3af; margin-bottom:.35rem;">Recommended playlists</div>
                    <div style="display:flex; flex-direction:column; gap:.35rem;">
                        <button class="m3u-preset" data-url="https://iptv-org.github.io/iptv/languages/eng.m3u" style="text-align:left;background:rgba(255,255,255,.06); color:#e5e7eb; border:1px solid rgba(255,255,255,.12); padding:.45rem .6rem; border-radius:6px; cursor:pointer;">
                            <i class="fas fa-bolt" style="color:#f59e0b;"></i> Load English (iptv-org)
                        </button>
                        <button class="m3u-preset" data-url="https://iptv-org.github.io/iptv/index.m3u" style="text-align:left;background:rgba(255,255,255,.06); color:#e5e7eb; border:1px solid rgba(255,255,255,.12); padding:.45rem .6rem; border-radius:6px; cursor:pointer;">
                            <i class="fas fa-bolt" style="color:#f59e0b;"></i> Load Global index (iptv-org)
                        </button>
                    </div>
                </div>
                <div id="xtream-login-status" style="font-size:.9rem; color:#9ca3af; min-height:1.2rem;"></div>
            </div>
        </div>
    </div>


    <!-- Xtream Player Modal (basic) -->
    <div id="xtream-player-modal" style="display:none; position:fixed; inset:0;background:rgba(0,0,0,.8); z-index:16000; align-items:center; justify-content:center;">
        <div style="width:min(1000px,94vw);background:#000; border-radius:10px; overflow:hidden; border:1px solid rgba(255,255,255,.15);">
            <div style="display:flex; justify-content:space-between; align-items:center; padding:.5rem .75rem;background:#0f0f0f;">
                <div id="xtream-player-title" style="color:#fff; font-weight:600;">Playing</div>
                <div style="display:flex; gap:.5rem;">
                    <button id="xtream-open-mpv" style="display:none;background:linear-gradient(135deg,#10b981,#059669); color:#fff; border:none; padding:.4rem .7rem; border-radius:6px; cursor:pointer;">
                        <i class="fas fa-play"></i> Open in Player
                    </button>
                    <button id="xtream-open-iina" style="display:none;background:linear-gradient(135deg,#22c55e,#16a34a); color:#fff; border:none; padding:.4rem .7rem; border-radius:6px; cursor:pointer;">
                        <i class="fas fa-play-circle"></i> Open in IINA
                    </button>
                    <button id="xtream-open-vlc" style="background:linear-gradient(135deg,#f97316,#ea580c); color:#fff; border:none; padding:.4rem .7rem; border-radius:6px; cursor:pointer;">
                        <i class="fas fa-film"></i> Open in VLC
                    </button>
                    <button id="xtream-open-external" style="background:linear-gradient(135deg,#3b82f6,#2563eb); color:#fff; border:none; padding:.4rem .7rem; border-radius:6px; cursor:pointer;">
                        <i class="fas fa-external-link-alt"></i> Open in Browser
                    </button>
                    <button id="xtream-player-close" style="background:transparent;color:#fff;border:none;font-size:1.25rem;cursor:pointer;"><i class="fas fa-times"></i></button>
                </div>
            </div>
            <div style="background:#000;">
                <video id="xtream-video" style="width:100%; height:65vh;background:#000;" controls playsinline></video>
            </div>
        </div>
    </div>

    <!-- Games Downloader Page -->
    <div id="games-downloader-page" class="page-wrapper" style="display: none;">
        <div class="page-header" style="text-align: center;">
            <h2><i class="fas fa-download" style="color:#8b5cf6"></i> Games Downloader</h2>
            <p style="color: var(--secondary); margin-top: 0.5rem; font-size: 0.95rem;">Search for PC games or browse downloadable games from SteamRip and FitGirl databases</p>
        </div>

        <div class="page-content">
            <!-- Tab Navigation -->
            <div style="display: flex; justify-content: center; gap: 0.5rem; margin-bottom: 1.5rem;">
                <button id="games-browse-tab" class="games-tab-btn active" style="padding: 0.75rem 2rem;background: linear-gradient(135deg, #8b5cf6, #7c3aed); border: none; border-radius: 8px; color: white; font-weight: 600; cursor: pointer; transition: all 0.3s;">
                    <i class="fas fa-search"></i> Browse Games
                </button>
                <button id="games-library-tab" class="games-tab-btn" style="padding: 0.75rem 2rem;background: rgba(139,92,246,0.2); border: 2px solid rgba(139,92,246,0.3); border-radius: 8px; color: #a78bfa; font-weight: 600; cursor: pointer; transition: all 0.3s;">
                    <i class="fas fa-folder"></i> My Library <span id="games-library-count" style="background: #ef4444; color: white; padding: 0.1rem 0.5rem; border-radius: 10px; font-size: 0.75rem; margin-left: 0.3rem; display: none;">0</span>
                </button>
                <button id="games-open-folder-btn" style="padding: 0.75rem 1rem;background: rgba(16,185,129,0.2); border: 2px solid rgba(16,185,129,0.3); border-radius: 8px; color: #10b981; font-weight: 600; cursor: pointer; transition: all 0.3s;" title="Open Downloads Folder">
                    <i class="fas fa-folder-open"></i>
                </button>
            </div>
            
            <!-- TorBox Status Banner -->
            <div id="games-torbox-status" style="max-width: 800px; margin: 0 auto 1rem auto; padding: 0.75rem 1rem; border-radius: 8px; display: none;">
            </div>

            <!-- Browse Section -->
            <div id="games-browse-section">
                <!-- Search Section -->
                <div class="search-section" style="max-width: 800px; margin: 2rem auto; text-align: center;">
                    <div style="display: flex; gap: 0.5rem; margin-bottom: 1rem;">
                        <input 
                            type="text" 
                            id="games-search-input" 
                            placeholder="Search for PC games (e.g., Call of Duty, GTA, Cyberpunk)..." 
                            style="flex: 1; padding: 0.75rem 1rem; border: 2px solid rgba(139,92,246,0.3); border-radius: 8px;background: rgba(139,92,246,0.05); color: var(--light); font-size: 1rem;"
                        >
                        <button 
                            id="games-search-btn" 
                            style="padding: 0.75rem 1.5rem;background: linear-gradient(135deg, #8b5cf6, #7c3aed); border: none; border-radius: 8px; color: white; font-weight: 600; cursor: pointer; transition: transform 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);"
                            onmouseover="this.style.transform='scale(1.05)'" 
                            onmouseout="this.style.transform='scale(1)'"
                        >
                            <i class="fas fa-search"></i> Search
                        </button>
                    </div>
                    <button 
                        id="games-browse-all-btn" 
                        style="padding: 0.6rem 1.2rem;background: linear-gradient(135deg, #f97316, #ea580c); border: none; border-radius: 8px; color: white; font-weight: 600; cursor: pointer; transition: transform 0.5s cubic-bezier(0.34, 1.56, 0.64, 1); margin-bottom: 1rem;"
                        onmouseover="this.style.transform='scale(1.05)'" 
                        onmouseout="this.style.transform='scale(1)'"
                    >
                        <i class="fas fa-th"></i> Browse All Games
                    </button>
                    <div id="games-search-status" style="color: var(--secondary); font-size: 0.9rem; min-height: 1.5rem;"></div>
                </div>

                <!-- Categories Section -->
                <div id="games-categories-section" style="max-width: 1200px; margin: 0 auto 2rem auto; padding: 0 1rem;">
                    <h3 style="color: var(--light); margin-bottom: 1rem; text-align: center;"><i class="fas fa-tags" style="color:#8b5cf6"></i> Browse by Category</h3>
                    <div style="display: flex; justify-content: center; gap: 0.5rem; margin-bottom: 2rem;">
                        <select 
                            id="games-category-select" 
                            style="padding: 0.75rem 1rem; border: 2px solid rgba(139,92,246,0.3); border-radius: 8px;background: rgba(139,92,246,0.05); color: var(--light); font-size: 1rem; cursor: pointer; min-width: 250px;"
                        >
                            <option value="">Select a category...</option>
                        </select>
                        <button 
                            id="games-category-btn" 
                            style="padding: 0.75rem 1.5rem;background: linear-gradient(135deg, #8b5cf6, #7c3aed); border: none; border-radius: 8px; color: white; font-weight: 600; cursor: pointer; transition: transform 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);"
                            onmouseover="this.style.transform='scale(1.05)'" 
                            onmouseout="this.style.transform='scale(1)'"
                        >
                            <i class="fas fa-filter"></i> Filter
                        </button>
                    </div>
                </div>

                <!-- Results Section -->
                <div id="games-results-section" style="display: none;">
                    <div class="books-results-header" style="align-items:center; gap:1rem; margin-bottom: 1rem;">
                        <h3><i class="fas fa-list" style="color:#8b5cf6"></i> Search Results</h3>
                        <div id="games-results-count" class="books-results-count"></div>
                    </div>
                    <div id="games-results-grid" class="books-results-grid"></div>
                </div>

                <!-- Empty State -->
                <div id="games-empty-state" class="books-empty" style="display: none;">
                </div>
            </div>

            <!-- Library Section -->
            <div id="games-library-section" style="display: none;">
                <div style="max-width: 1200px; margin: 0 auto; padding: 0 1rem;">
                    <div class="books-results-header" style="align-items:center; gap:1rem; margin-bottom: 1rem;">
                        <h3><i class="fas fa-folder" style="color:#8b5cf6"></i> My Downloads</h3>
                        <button id="games-refresh-library-btn" style="padding: 0.5rem 1rem;background: rgba(139,92,246,0.2); border: 1px solid rgba(139,92,246,0.3); border-radius: 6px; color: #a78bfa; cursor: pointer;">
                            <i class="fas fa-sync-alt"></i> Refresh
                        </button>
                    </div>
                    
                    <!-- Library Grid -->
                    <div id="games-library-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); gap: 1rem;">
                        <!-- Downloads will be rendered here -->
                    </div>
                    
                    <!-- Empty Library State -->
                    <div id="games-library-empty" style="text-align: center; padding: 3rem; color: var(--secondary);">
                        <i class="fas fa-folder-open" style="font-size: 4rem; color: rgba(139,92,246,0.3); margin-bottom: 1rem;"></i>
                        <h3 style="color: var(--light); margin-bottom: 0.5rem;">No Downloads Yet</h3>
                        <p>Games you download will appear here. Browse games and click "Add to Library" to start downloading.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- PlayTorrio MiniGames Page -->
    <div id="minigames-page" style="display: none;">
        <div class="page-content" style="padding: 0; height: 100vh; overflow: hidden;">
            <iframe 
                id="minigames-iframe" 
                src="https://playtorriogames.pages.dev/" 
                style="width: 100%; height: 100%; border: none;"
                allowfullscreen>
            </iframe>
        </div>
    </div>

    <!-- Books Page -->
    <div id="books-page" style="display: none;">
        <div class="page-header-enhanced">
            <div class="page-title-section">
                <h2 class="section-title">
                    <i class="fas fa-book" style="color: #f59e0b;"></i> <span>Books</span>
                </h2>
                <p class="page-subtitle">Search and read books from Z-Library</p>
            </div>
        </div>

        <div class="page-content">
            <!-- Search Section -->
            <div class="books-search-section">
                <div class="books-search-container">
                    <div class="books-search-bar">
                        <i class="fas fa-search books-search-icon"></i>
                        <input 
                            type="text" 
                            id="books-search-input" 
                            placeholder="Search for books, authors, or titles..."
                            autocomplete="off"
                        />
                        <button id="books-search-btn" class="books-search-button">
                            <i class="fas fa-search"></i>
                            Search
                        </button>
                        <button id="books-saved-btn" class="books-search-button" style="margin-left: 10px;background: #2ecc71;">
                            <i class="fas fa-bookmark"></i>
                            Saved
                        </button>
                    </div>
                </div>
            </div>

            <!-- Loading State -->
            <div id="books-loading" class="books-loading" style="display: none;">
                <div class="books-loading-spinner">
                    <i class="fas fa-spinner fa-spin"></i>
                </div>
                <p>Searching Z-Library...</p>
            </div>

            <!-- Empty State -->
            <div id="books-empty" class="books-empty">
                <div class="books-empty-icon">
                    <i class="fas fa-book-open"></i>
                </div>
                <h3>Welcome to Z-Library Search</h3>
                <p>Search for any book, author, or topic to get started.</p>
            </div>

            <!-- Results Section -->
            <div id="books-results" class="books-results" style="display: none;">
                <div class="books-results-header">
                    <h3 id="books-results-title">Search Results</h3>
                    <div id="books-results-count" class="books-results-count"></div>
                </div>
                <div id="books-results-grid" class="books-results-grid">
                    <!-- Results will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Books Reader Modal -->
    <div id="books-reader-modal" class="books-reader-modal" style="display: none;">
        <div class="books-reader-content">
            <div class="books-reader-header">
                <button id="books-reader-back" class="books-reader-back-btn">
                    <i class="fas fa-arrow-left"></i>
                   back
                </button>
                <h3 id="books-reader-title">Reading...</h3>
            </div>
            <div class="books-reader-frame-container">
                <iframe id="books-reader-frame" class="books-reader-frame"></iframe>
            </div>
        </div>
    </div>

    <!-- Server Selection Modal -->
    <div id="server-selection-modal" class="server-selection-modal" style="display: none;">
        <div class="server-selection-content">
            <div class="server-selection-header">
                <button id="server-selection-back" class="server-selection-back-btn">
                    <i class="fas fa-arrow-left"></i>
                   back
                </button>
                <h3 id="server-selection-title">Select Streaming Server</h3>
            </div>
            <div class="server-selection-body">
                <div class="server-selection-info">
                    <div class="media-info">
                        <img id="server-media-poster" class="media-poster" src="" alt="Media Poster">
                        <div class="media-details">
                            <h4 id="server-media-title">Movie/Show Title</h4>
                            <p id="server-media-subtitle">Episode details</p>
                            <div class="media-meta">
                                <span id="server-media-year" class="media-year"></span>
                                <span id="server-media-rating" class="media-rating"></span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="server-dropdown-section">
                    <label for="server-dropdown" class="server-dropdown-label">
                        <i class="fas fa-server"></i>
                        Choose Streaming Server:
                    </label>
                    <div class="server-dropdown-container">
                        <select id="server-dropdown" class="server-dropdown">
                            <!-- Options will be populated by JavaScript -->
                        </select>
                        <i class="fas fa-chevron-down server-dropdown-arrow"></i>
                    </div>
                </div>
                <div class="server-actions">
                    <button id="server-watch-btn" class="server-watch-btn">
                        <i class="fas fa-play"></i>
                        Start Watching
                    </button>
                    <button id="server-torrent-btn" class="server-torrent-btn">
                        <i class="fas fa-download"></i>
                        Use Torrent Instead
                    </button>
                </div>
                
                <!-- Embedded Video Player Section -->
                <div id="server-video-section" class="server-video-section" style="display: none;">
                    <div class="server-video-header">
                        <h4 id="server-video-title">Now Playing</h4>
                        <button id="server-video-close" class="server-video-close">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="server-video-container">
                        <iframe id="server-video-frame" class="server-video-iframe" 
                                src="" 
                                allowfullscreen>
                        </iframe>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Chromecast Device Selection Modal -->
    <div id="chromecast-device-modal" class="modal" style="display: none; z-index: 6000;">
        <div class="modal-content" style="max-width: 500px;">
            <div class="chromecast-modal-header">
                <h3><i class="fas fa-tv"></i> Select Chromecast Device</h3>
                <button class="close-modal" id="close-chromecast-modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div id="chromecast-device-list" class="chromecast-device-list">
                    <div class="loading-spinner">
                        <i class="fas fa-spinner fa-spin"></i>
                        <p>Discovering devices...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Custom Magnet Link Modal -->
    <div id="custom-magnet-modal" class="modal" style="display: none; z-index: 6000;">
        <div class="modal-content" style="width: 420px; max-width: 92vw;background: #0f172a; border-radius: 10px; box-shadow: 0 20px 40px rgba(0,0,0,0.5); border: 1px solid rgba(139,92,246,0.25); padding: 12px 12px 10px; position: relative;">
            <button id="close-custom-magnet-modal" style="position: absolute; top: 8px; right: 8px;background: rgba(255,255,255,0.12); color: #fff; border: none; width: 28px; height: 28px; border-radius: 6px; cursor: pointer; display: flex; align-items: center; justify-content: center;">
                <i class="fas fa-times"></i>
            </button>
            <h3 style="margin: 0 36px 8px 0; display: flex; align-items: center; gap: 6px; color: #e2e8f0; font-size: 0.95rem; font-weight: 700;">
                <i class="fas fa-magnet" style="color: #a78bfa;"></i> Play Custom Magnet
            </h3>
            <div style="margin: 6px 0 8px;">
                <label for="custom-magnet-input" style="display: block; margin-bottom: 6px; color: #cbd5e1; font-weight: 600; font-size: 0.8rem;">
                    <i class="fas fa-link" style="color: #8b5cf6;"></i> Magnet Link
                </label>
                <input 
                    id="custom-magnet-input"
                    type="text"
                    placeholder="magnet:?xt=urn:btih:..."
                    style="width: 100%; height: 38px; padding: 8px 10px; border: 1.5px solid rgba(139,92,246,0.5); border-radius: 8px;background: #0b1220; color: #e2e8f0; font-size: 0.85rem; font-family: 'Consolas', 'Courier New', monospace; outline: none;"
                    onfocus="this.style.borderColor='#8b5cf6'; this.style.boxShadow='0 0 0 3px rgba(139,92,246,0.15)';"
                    onblur="this.style.borderColor='rgba(139,92,246,0.5)'; this.style.boxShadow='none';"
                />
            </div>
            <div style="display: flex; gap: 8px; justify-content: flex-end; margin-top: 8px;">
                <button id="cancel-custom-magnet-btn" style="padding: 8px 14px; border-radius: 8px; font-weight: 600;background: rgba(71,85,105,0.3); border: 1.5px solid rgba(71,85,105,0.5); color: #cbd5e1; cursor: pointer; font-size: 0.85rem;">
                    Cancel
                </button>
                <button id="play-custom-magnet-btn" style="background: linear-gradient(135deg, #8b5cf6 0%, #6d28d9 100%); border: none; padding: 8px 14px; border-radius: 8px; font-weight: 700; display: flex; align-items: center; gap: 6px; color: #fff; cursor: pointer; font-size: 0.85rem;">
                    <i class="fas fa-play-circle"></i> Play
                </button>
            </div>
        </div>
    </div>

    <!-- Video Player Modal -->
    <div id="video-player-modal" class="video-player-modal" style="display: none;">
        <div class="video-player-content">
            <div class="video-player-header">
                <button id="video-player-back" class="video-player-back-btn">
                    <i class="fas fa-arrow-left"></i>
                   back to Servers
                </button>
                <h3 id="video-player-title">Now Playing</h3>
                <div class="video-player-controls">
                    <button id="video-player-fullscreen" class="video-player-control-btn">
                        <i class="fas fa-expand"></i>
                    </button>
                </div>
            </div>
            <div class="video-player-frame-container">
                <iframe id="video-player-frame" class="video-player-frame"></iframe>
            </div>
        </div>
    </div>

    <!-- AudioBooks Page -->
    <div id="audiobooks-page" style="display: none;">
        <!-- Books View -->
        <div id="audiobooks-books-view">
            <div class="page-header-enhanced">
                <div class="page-title-section">
                    <h2 class="section-title">
                        <i class="fas fa-headphones" style="color: #8b5cf6;"></i> <span>AudioBooks</span>
                    </h2>
                    <p class="page-subtitle">Search and stream audiobooks</p>
                </div>
            </div>

            <div class="page-content">
                <!-- Search Section -->
                <div class="search-section" style="margin-bottom: 2rem;">
                    <div class="search-container-books">
                        <input type="text" id="audiobookSearchInput" placeholder="Search for audiobooks..." class="search-input-books">
                        <button id="searchAudioBooksBtn" class="search-btn-books">
                            <i class="fas fa-search"></i> Search
                        </button>
                        <button id="clearAudioBookSearchBtn" class="search-btn-books" style="margin-left: 0.5rem;background: #e74c3c; display: none;">
                            <i class="fas fa-arrow-left"></i>back to Home
                        </button>
                    </div>
                </div>

                <div id="audiobookSearchResults" class="books-grid">
                    <div class="search-placeholder">
                        <i class="fas fa-headphones" style="font-size: 3rem; color: #8b5cf6; margin-bottom: 1rem;"></i>
                        <h3>Discover AudioBooks</h3>
                        <p>Browse audiobooks or search for your favorites</p>
                    </div>
                </div>

                <!-- Loading indicator -->
                <div id="audiobookLoading" style="display: none; text-align: center; padding: 2rem;">
                    <i class="fas fa-spinner fa-spin" style="font-size: 2rem; color: #8b5cf6;"></i>
                    <p style="margin-top: 1rem; color: #666;">Loading audiobooks...</p>
                </div>

                <!-- Load More Button -->
                <div id="audiobookLoadMoreContainer" style="display: none; text-align: center; margin: 2rem auto; width: 100%;">
                    <button id="audiobookLoadMoreBtn" class="action-btn" style="background: linear-gradient(135deg, #8b5cf6, #7c3aed); padding: 1rem 2.5rem; font-size: 1rem;">
                        <i class="fas fa-plus-circle"></i> Load More
                    </button>
                </div>
            </div>
        </div>

        <!-- Chapters View -->
        <div id="audiobooks-chapters-view" style="display: none;">
            <div class="page-header-enhanced">
                <div class="page-title-section">
                    <button id="audiobooksBackToBooks" class="action-btn" style="margin-right: 1rem;">
                        <i class="fas fa-arrow-left"></i>back to Books
                    </button>
                    <h2 class="section-title" id="audiobooksChapterBookTitle" style="color: #8b5cf6;">
                        <i class="fas fa-headphones"></i> <span></span>
                    </h2>
                </div>
            </div>

            <div class="page-content">
                <div id="audiobooksChapterLoading" style="display: none; text-align: center; padding: 2rem;">
                    <i class="fas fa-spinner fa-spin" style="font-size: 2rem; color: #8b5cf6;"></i>
                    <p style="margin-top: 1rem; color: #666;">Loading chapters...</p>
                </div>

                <div id="audiobooksChaptersList" style="display: flex; flex-direction: column; gap: 10px;">
                    <!-- Chapters will be inserted here -->
                </div>
            </div>
        </div>

        <!-- Audio Player (Fixed at bottom within audiobooks page) -->
        <div id="audiobooksPlayer" style="display: none; position: fixed; bottom: 0; left: 240px; right: 0;background: linear-gradient(135deg, #8b5cf6, #7c3aed); padding: 20px; box-shadow: 0 -5px 20px rgba(0,0,0,0.3); z-index: 1000;">
            <button id="audiobooksClosePlayer" style="position: absolute; top: 10px; right: 10px;background: rgba(255,255,255,0.2); border: none; color: white; width: 30px; height: 30px; border-radius: 50%; cursor: pointer; font-size: 18px; display: flex; align-items: center; justify-content: center; transition: all 0.3s;"><i class="fas fa-times"></i></button>
            
            <div style="max-width: 1200px; margin: 0 auto;">
                <div style="color: white; margin-bottom: 15px; text-align: center;">
                    <div id="audiobooksPlayerTitle" style="font-size: 18px; font-weight: 600; margin-bottom: 5px;">No Audio Selected</div>
                    <div id="audiobooksPlayerChapter" style="font-size: 14px; opacity: 0.9;"></div>
                    <div style="margin-top: 8px;">
                        <select id="audiobooksPlaybackSpeed" style="background: rgba(255,255,255,0.2); color: white; border: 1px solid rgba(255,255,255,0.3); border-radius: 12px; padding: 2px 8px; font-size: 12px; cursor: pointer; outline: none;">
                            <option value="0.5" style="background: #7c3aed;">0.5x</option>
                            <option value="0.75" style="background: #7c3aed;">0.75x</option>
                            <option value="1" selected style="background: #7c3aed;">1x (Normal)</option>
                            <option value="1.25" style="background: #7c3aed;">1.25x</option>
                            <option value="1.5" style="background: #7c3aed;">1.5x</option>
                            <option value="1.75" style="background: #7c3aed;">1.75x</option>
                            <option value="2" style="background: #7c3aed;">2x</option>
                            <option value="2.25" style="background: #7c3aed;">2.25x</option>
                            <option value="2.5" style="background: #7c3aed;">2.5x</option>
                            <option value="2.75" style="background: #7c3aed;">2.75x</option>
                            <option value="3" style="background: #7c3aed;">3x</option>
                        </select>
                    </div>
                </div>
                
                <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
                    <button id="audiobooksPrevBtn" class="action-btn" style="background: rgba(255,255,255,0.2); color: white; min-width: 45px; height: 45px; padding: 0; display: flex; align-items: center; justify-content: center; font-size: 18px; transition: all 0.3s;"><i class="fas fa-step-backward"></i></button>
                    <button id="audiobooksPlayPauseBtn" class="action-btn" style="background: white; color: #8b5cf6; font-size: 20px; min-width: 55px; height: 55px; padding: 0; display: flex; align-items: center; justify-content: center; transition: all 0.3s;"><i class="fas fa-play"></i></button>
                    <button id="audiobooksNextBtn" class="action-btn" style="background: rgba(255,255,255,0.2); color: white; min-width: 45px; height: 45px; padding: 0; display: flex; align-items: center; justify-content: center; font-size: 18px; transition: all 0.3s;"><i class="fas fa-step-forward"></i></button>
                    
                    <div style="flex: 1; display: flex; align-items: center; gap: 10px;">
                        <span id="audiobooksCurrentTime" style="color: white; font-size: 13px; min-width: 45px;">0:00</span>
                        <div id="audiobooksProgressBar" style="flex: 1; height: 6px;background: rgba(255,255,255,0.3); border-radius: 3px; cursor: pointer; position: relative;">
                            <div id="audiobooksProgressFilled" style="height: 100%;background: white; border-radius: 3px; width: 0%; position: relative;">
                                <div style="position: absolute; right: -6px; top: 50%; transform: translateY(-50%); width: 12px; height: 12px;background: white; border-radius: 50%; box-shadow: 0 2px 5px rgba(0,0,0,0.3);"></div>
                            </div>
                        </div>
                        <span id="audiobooksDuration" style="color: white; font-size: 13px; min-width: 45px;">0:00</span>
                    </div>

                    <button id="audiobooksVolumeBtn" class="action-btn" style="background: rgba(255,255,255,0.2); color: white; min-width: 45px; height: 45px; padding: 0; display: flex; align-items: center; justify-content: center; font-size: 18px; transition: all 0.3s;"><i class="fas fa-volume-up"></i></button>
                    <input type="range" id="audiobooksVolumeSlider" min="0" max="100" value="100" style="width: 80px;">
                </div>
            </div>
        </div>

        <audio id="audiobooksAudioElement" preload="metadata"></audio>
    </div>

    <!-- BookTorrio Page -->
    <div id="booktorrio-page" style="display: none;">
        <div class="page-header-enhanced">
            <div class="page-title-section">
                <h2 class="section-title">
                    <i class="fas fa-book-open" style="color: #06b6d4;"></i> <span>BookTorrio</span>
                </h2>
                <p class="page-subtitle">Search and download EPUB books</p>
            </div>
        </div>

        <div class="page-content">
            <!-- Navigation Buttons -->
            <div class="booktorrio-nav" style="margin-bottom: 2rem;">
                <button id="searchTabBtn" class="booktorrio-tab-btn active">
                    <i class="fas fa-search"></i> Search
                </button>
                <button id="libraryTabBtn" class="booktorrio-tab-btn">
                    <i class="fas fa-bookmark"></i> Library
                </button>
            </div>

            <!-- Search Tab -->
            <div id="searchTab" class="booktorrio-tab">
                <div class="search-section" style="margin-bottom: 2rem;">
                    <div class="search-container-books">
                        <input type="text" id="bookSearchInput" placeholder="Search for books..." class="search-input-books">
                        <button id="searchBooksBtn" class="search-btn-books">
                            <i class="fas fa-search"></i> Search
                        </button>
                    </div>
                </div>

                <div id="bookSearchResults" class="books-grid">
                    <div class="search-placeholder">
                        <i class="fas fa-book-open" style="font-size: 3rem; color: #06b6d4; margin-bottom: 1rem;"></i>
                        <h3>Search for Books</h3>
                        <p>Enter a book title above to find EPUB books</p>
                    </div>
                </div>

                <div id="bookSearchLoading" style="display: none; text-align: center; padding: 2rem;">
                    <div class="spinner"></div>
                    <p>Searching for books...</p>
                </div>
            </div>

            <!-- Library Tab (Empty for now) -->
            <div id="libraryTab" class="booktorrio-tab" style="display: none;">
                <div class="search-placeholder">
                    <i class="fas fa-bookmark" style="font-size: 3rem; color: #06b6d4; margin-bottom: 1rem;"></i>
                    <h3>Library</h3>
                    <p>Your saved books will appear here</p>
                </div>
            </div>
        </div>
    </div>

    <!-- EPUB Reader Overlay -->
    <div id="epubReaderOverlay" style="display:none;">
        <div class="reader-header">
            <div class="reader-esc-hint">PlayTorrio Reader</div>
            <div class="reader-title" id="readerTitle"></div>
            <div style="width: 120px;"></div> <!-- Spacer for symmetry -->
        </div>
        <div id="readerContainer"></div>
        <div id="focusRuler"></div>
        <div class="reader-footer">
            <button id="readerBackBtn" class="reader-back-btn" title="Exit reader">
                <i class="fas fa-arrow-left"></i>
                <span>Back</span>
            </button>
            <div class="reader-nav-controls">
                <button id="readerPrevBtn" class="reader-nav-btn" title="Previous page"><i class="fas fa-chevron-left"></i></button>
                <button id="readerNextBtn" class="reader-nav-btn" title="Next page"><i class="fas fa-chevron-right"></i></button>
            </div>
            <div id="readerChapterControls" class="reader-chapter-controls" style="display:none;">
                <span class="chapter-count-label">Chapters: <strong id="readerChapterCount">0</strong></span>
                <input id="readerChapterInput" type="number" min="1" step="1" placeholder="1" title="Enter chapter number" />
                <button id="readerChapterGo" class="reader-nav-btn" title="Go to chapter"><i class="fas fa-arrow-right"></i></button>
            </div>
            <button id="readerSettingsBtn" class="reader-gear" aria-label="Settings"><i class="fas fa-cog"></i></button>
        </div>
        <div id="readerSettingsPanel" class="reader-settings hidden">
            <div class="reader-settings-section">
                <label>Theme</label>
                <div class="settings-row">
                    <button class="theme-btn" data-theme="light">Light</button>
                    <button class="theme-btn" data-theme="dark">Dark</button>
                    <button class="theme-btn" data-theme="night">Night</button>
                </div>
            </div>
            <div class="reader-settings-section">
                <label>Focus Mode</label>
                <div class="settings-row">
                    <button id="focusModeBtn" class="align-btn" style="width:100%"><i class="fas fa-eye"></i> Enable Focus</button>
                </div>
                <div style="font-size: 0.8rem; color: #888; margin-top: 0.5rem; text-align: center;">
                    Use arrow keys to control the line
                </div>
                <div style="margin-top: 0.5rem; display: flex; align-items: center; justify-content: space-between;">
                    <label style="font-size: 0.9rem; color: #ccc;">Speed</label>
                    <input id="focusSpeedInput" type="range" min="1" max="20" value="2" style="width: 60%;">
                    <span id="focusSpeedVal" style="font-size: 0.9rem; width: 20px; text-align: right;">2</span>
                </div>
            </div>
            <div class="reader-settings-section">
                <label>Font</label>
                <select id="readerFont" class="modal-select" style="width:100%">
                    <option value="-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif">System Default</option>
                    <option value="Georgia, Cambria, 'Times New Roman', Times, serif">Serif</option>
                    <option value="Arial, Helvetica, sans-serif">Sans-Serif</option>
                    <option value="'Courier New', Courier, monospace">Monospace</option>
                </select>
            </div>
            <div class="reader-settings-section">
                <div class="settings-row justify">
                    <label>Text Size</label>
                    <span id="readerFontSizeVal">16px</span>
                </div>
                <input id="readerFontSize" type="range" min="12" max="32" step="1" value="16" style="width:100%"/>
            </div>
            <div class="reader-settings-section">
                <div class="settings-row justify">
                    <label>Line Height</label>
                    <span id="readerLineHeightVal">1.5</span>
                </div>
                <input id="readerLineHeight" type="range" min="1.0" max="2.5" step="0.1" value="1.5" style="width:100%"/>
            </div>
            <div class="reader-settings-section">
                <div class="settings-row justify">
                    <label>Content Width</label>
                    <span id="readerWidthVal">80%</span>
                </div>
                <input id="readerWidth" type="range" min="40" max="100" step="5" value="80" style="width:100%"/>
            </div>
            <div class="reader-settings-section">
                <label>Alignment</label>
                <div class="settings-row">
                    <button class="align-btn" data-align="left"><i class="fas fa-align-left"></i></button>
                    <button class="align-btn" data-align="justify"><i class="fas fa-align-justify"></i></button>
                </div>
            </div>
        </div>
    </div>

    <!-- Anime Page -->
    <div id="anime-page" style="display: none;">
        <div class="page-header-enhanced">
            <div class="page-title-section">
                <h2 class="section-title">
                    <i class="fas fa-dragon" style="color: #3b82f6;"></i> <span>Anime</span>
                </h2>
                <p class="page-subtitle">Discover and watch anime with torrents</p>
            </div>
        </div>

        <!-- Search Section -->
        <div style="max-width: 900px; margin: 0 auto 2rem;">
            <div style="background: rgba(255,255,255,0.1); border-radius: 12px; padding: 1rem; box-shadow: 0 4px 12px rgba(0,0,0,0.3); position: relative;">
                <i class="fas fa-search" style="position: absolute; left: 1.5rem; top: 50%; transform: translateY(-50%); color: #3b82f6; font-size: 1.2rem; pointer-events: none;"></i>
                <input id="animeSearchInput" placeholder="Search for anime..." type="text" style="width: 100%; padding: 1rem 1rem 1rem 3rem;background: rgba(0,0,0,0.4); border: 2px solid rgba(59, 130, 246, 0.3); border-radius: 10px; color: var(--light); font-size: 1.1rem; transition: all 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94), transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1); box-sizing: border-box;" />
            </div>
        </div>

        <!-- Anime Grid -->
        <div id="animeGrid" class="movies-grid" style="margin-top: 2rem;">
            <!-- Anime cards will be loaded here -->
        </div>
        <div class="loading" id="animeLoadingIndicator" style="display: none;">
            <div class="spinner"></div>
            <p>Loading anime...</p>
        </div>
    </div>
<!-- Comics Page -->
<div id="comics-page" style="display: none;">

    <!-- HEADER -->
    <div class="page-header-enhanced" style="display:flex;justify-content:space-between;align-items:center;gap:1rem;flex-wrap:wrap;">
        <div class="page-title-section">
            <h2 class="section-title">
                <i class="fas fa-mask" style="color: #f97316;"></i>
                <span>Comics Library</span>
            </h2>
            <p class="page-subtitle">Read comics from ReadComicOnline (.ru)</p>
        </div>

        <!-- ACTION BUTTONS -->
        <div style="display:flex; gap:10px;">
            <button id="comics-saved-btn" 
                style="padding: 10px 25px; font-size: 15px; font-weight: bold;
                      background: rgba(249,115,22,0.25); color:#f97316;
                       border: 2px solid #f97316; border-radius: 10px; cursor:pointer;
                       transition:0.2s;">
                <i class="fas fa-heart"></i> Saved
            </button>
            <button id="comics-home-btn" 
                style="padding: 10px 25px; font-size: 15px; font-weight: bold;
                      background: rgba(249,115,22,0.25); color:#f97316;
                       border: 2px solid #f97316; border-radius: 10px; cursor:pointer;
                       transition:0.2s;">
                <i class="fas fa-home"></i> Home
            </button>
        </div>
    </div>

    <!-- SEARCH + GENRES -->
    <div id="comics-filter-container" style="max-width: 1000px; margin: 1.5rem auto 2rem; display:flex; flex-wrap:wrap; gap:15px; justify-content:center;">

        <!-- Search -->
        <div style="flex:1; min-width:260px; position:relative;">
            <i class="fas fa-search"
               style="position:absolute; left:1rem; top:50%; transform:translateY(-50%);
                      color:#f97316; font-size:1.1rem; pointer-events:none;"></i>

            <input id="comics-search-input"
                   placeholder="Search for comics… (e.g., Batman, Spawn)"
                   type="text"
                   style="width:100%; padding:0.9rem 1rem 0.9rem 2.8rem;background:rgba(0,0,0,0.45);
                          border:2px solid rgba(249,115,22,0.35); border-radius:10px;
                          color:white; font-size:1rem; outline:none; box-sizing:border-box;">
        </div>

        <!-- Genres Dropdown -->
        <div style="min-width:220px;">
            <select id="comics-genres-dropdown"
                    style="width:100%; padding:0.9rem 1rem;background:rgba(0,0,0,0.45);
                           border:2px solid rgba(249,115,22,0.5); border-radius:10px;
                           color:#f97316; font-weight:600; cursor:pointer; font-size:0.95rem;">
                <option value="">Genres</option>
                <!-- JS will populate options -->
            </select>
        </div>

    </div>

    <!-- Action Buttons -->
    <div id="comics-search-container" 
         style="max-width: 1000px; margin: 0 auto 30px; display:flex; gap:10px;
                align-items:center; justify-content:center;">

        <button id="comics-browse-btn"
                style="padding:12px 30px; font-size:16px; font-weight:bold;
                       border:none; border-radius:10px; cursor:pointer;
                       background:linear-gradient(135deg, rgba(249,115,22,0.2),
                       rgba(234,88,12,0.2)); color:#f97316;
                       border:2px solid rgba(249,115,22,0.5);
                       display:none; transition:0.2s;">
            Browse All
        </button>

        <button id="comics-back-btn"
                style="padding:12px 30px; font-size:16px; font-weight:bold;
                       border:none; border-radius:10px; cursor:pointer;
                       background:linear-gradient(135deg, rgba(249,115,22,0.2),
                       rgba(234,88,12,0.2)); color:#f97316;
                       border:2px solid rgba(249,115,22,0.5);
                       display:none; transition:0.2s;">
            <i class="fas fa-arrow-left"></i> Back
        </button>
        
        <button id="comics-zoom-out-btn" style="display:none; padding:12px 15px; font-size:16px; border:none; border-radius:10px; cursor:pointer; background:rgba(255,255,255,0.1); color:white; border:1px solid rgba(255,255,255,0.2); transition:0.2s;">
            <i class="fas fa-search-minus"></i>
        </button>
        <button id="comics-zoom-in-btn" style="display:none; padding:12px 15px; font-size:16px; border:none; border-radius:10px; cursor:pointer; background:rgba(255,255,255,0.1); color:white; border:1px solid rgba(255,255,255,0.2); transition:0.2s;">
            <i class="fas fa-search-plus"></i>
        </button>
        <button id="comics-fullscreen-btn" style="display:none; padding:12px 15px; font-size:16px; border:none; border-radius:10px; cursor:pointer; background:rgba(255,255,255,0.1); color:white; border:1px solid rgba(255,255,255,0.2); transition:0.2s;">
            <i class="fas fa-expand"></i>
        </button>
    </div>

    <!-- COMICS GRID -->
    <div id="comics-container"
         class="movies-grid"
         style="display:grid; grid-template-columns:repeat(auto-fill, minmax(200px,1fr));
                gap:20px; max-width:1400px; margin:0 auto;">
        <!-- cards injected by JS -->
    </div>

    <!-- LOAD MORE -->
    <div id="comics-load-more-container"
         style="text-align:center; margin:2rem auto; max-width:1400px; display:none;">
        <button id="comics-load-more-btn"
                style="padding:15px 40px; font-size:18px; font-weight:bold;
                       border:none; border-radius:12px; cursor:pointer;
                      background:linear-gradient(135deg,#f97316,#ea580c); color:white;
                       transition:0.2s; box-shadow:0 4px 12px rgba(249,115,22,0.4);">
            <i class="fas fa-arrow-down"></i> Load More Comics
        </button>
    </div>

    <!-- ISSUES LIST -->
    <div id="comics-issues-container"
         style="max-width:1400px; margin:0 auto; display:none;">
        <!-- chapters injected by JS -->
    </div>

    <!-- READER -->
    <div id="comics-reader-container"
         style="max-width:1000px; margin:0 auto; display:none;">
         <div id="comics-page-loader"
              style="text-align:center; padding:20px; color:#888;">
              Loading pages...
         </div>
    </div>

    <!-- MAIN LOADING -->
    <div id="comics-loading"
         style="text-align:center; padding:20px; font-size:18px; color:#888;">
         Loading...
    </div>
</div>


    <!-- Manga Page -->
    <div id="manga-page" style="display: none;">
        <div class="page-header-enhanced">
            <div class="page-title-section" style="display: flex; align-items: center; justify-content: space-between; width: 100%;">
                <h2 class="section-title" style="margin: 0;">
                    <i class="fas fa-book-reader" style="color: #ec4899;"></i> <span>Manga</span>
                </h2>
                <div id="manga-source-buttons" style="display: flex; gap: 1rem;">
                    <button id="weebcentral-btn" class="provider-btn active">WeebCentral</button>
                    <button id="comix-btn" class="provider-btn">Comix</button>
                    <button id="manga-saved-btn" class="provider-btn"><i class="fas fa-heart"></i> Saved</button>
                </div>
            </div>
            <p id="manga-source-subtitle" class="page-subtitle">Read manga from WeebCentral</p>
        </div>

        <!-- Search Section -->
        <div style="max-width: 900px; margin: 0 auto 2rem;">
            <div style="background: rgba(255,255,255,0.1); border-radius: 12px; padding: 1rem; box-shadow: 0 4px 12px rgba(0,0,0,0.3); position: relative; display: flex; gap: 1rem; align-items: center;">
                <div style="position: relative; flex-grow: 1;">
                    <i class="fas fa-search" style="position: absolute; top: 50%; left: 1rem; transform: translateY(-50%); color: #ec4899; font-size: 1.2rem; pointer-events: none;"></i>
                    <input id="mangaSearchInput" placeholder="Search for manga..." type="text" style="width: 100%; padding: 1rem 1rem 1rem 3rem;background: rgba(0,0,0,0.4); border: 2px solid rgba(236, 72, 153, 0.3); border-radius: 10px; color: var(--light); font-size: 1.1rem; transition: all 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94), transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1); box-sizing: border-box;" />
                </div>
                <div id="manga-categories-container" style="display: none;">
                    <select id="manga-categories-dropdown" class="livetv-category-dropdown" style="width: 200px; border-color: rgba(236, 72, 153, 0.3);background: linear-gradient(135deg, rgba(236, 72, 153, 0.12), rgba(236, 72, 153, 0.08));">
                        <option value="">All Categories</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Manga Grid -->
        <div id="mangaGrid" class="movies-grid" style="margin-top: 2rem;">
            <!-- Manga cards will be loaded here -->
        </div>
        <div class="loading" id="mangaLoadingIndicator" style="display: none;">
            <i class="fas fa-spinner"></i> Loading manga...
        </div>
    </div>

    <!-- Manga Reader Page -->
    <div id="manga-reader-page" style="display: none;background: #000; min-height: 100vh; position: relative;">
        <!-- Floating Controls -->
        <div id="mangaReaderControls" style="position: sticky; top: 1rem; left: 1rem; z-index: 1000; display: flex; gap: 10px; width: fit-content; margin-bottom: 1rem;">
            <button id="mangaReaderBack" style="background: var(--secondary); border: none; padding: 0.75rem 1.5rem; border-radius: 8px; color: white; font-size: 1rem; cursor: pointer; display: flex; align-items: center; gap: 0.5rem; transition: all 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94), transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1); box-shadow: 0 4px 12px rgba(0,0,0,0.5);">
                <i class="fas fa-arrow-left"></i>back
            </button>
            <button id="mangaZoomOut" style="background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); padding: 0.75rem 1rem; border-radius: 8px; color: white; cursor: pointer;backdrop-filter: blur(5px); transition:background 0.2s;">
                <i class="fas fa-search-minus"></i>
            </button>
            <button id="mangaZoomIn" style="background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); padding: 0.75rem 1rem; border-radius: 8px; color: white; cursor: pointer;backdrop-filter: blur(5px); transition:background 0.2s;">
                <i class="fas fa-search-plus"></i>
            </button>
            <button id="mangaFullscreenBtn" style="background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); padding: 0.75rem 1rem; border-radius: 8px; color: white; cursor: pointer;backdrop-filter: blur(5px); transition:background 0.2s;">
                <i class="fas fa-expand"></i>
            </button>
        </div>
        
        <!-- Keyboard Navigation Hint -->
        <div style="position: fixed; right: 1.5rem; top: 50%; transform: translateY(-50%); z-index: 900;background: rgba(0,0,0,0.7); padding: 1rem; border-radius: 8px; color: white; font-size: 0.9rem; text-align: center;backdrop-filter: blur(10px); box-shadow: 0 4px 12px rgba(0,0,0,0.5); max-width: 120px;">
            <i class="fas fa-keyboard" style="font-size: 1.5rem; margin-bottom: 0.5rem; display: block;"></i>
            <p style="margin: 0; line-height: 1.4;">Use arrow keys to scroll</p>
            <div style="margin-top: 0.5rem; font-size: 1.2rem;">
                <div><i class="fas fa-arrow-up"></i></div>
                <div><i class="fas fa-arrow-down"></i></div>
            </div>
        </div>

        <div id="mangaReaderTitle" style="text-align: center; padding: 1rem; color: white; font-size: 1.5rem; font-weight: 600;">
            <!-- Chapter title will be here -->
        </div>
        <div id="mangaReaderPages" style="max-width: 1200px; margin: 0 auto; padding: 1rem;">
            <!-- Manga pages will be loaded here -->
        </div>
        <div id="mangaReaderLoading" style="text-align: center; padding: 3rem; color: white;">
            <i class="fas fa-spinner fa-spin" style="font-size: 3rem; margin-bottom: 1rem;"></i>
            <p style="font-size: 1.2rem;">Loading chapter...</p>
        </div>
    </div>

    <!-- Manga Details Modal -->
    <div id="mangaDetailsModal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0;background: rgba(0,0,0,0.95); z-index: 10000; overflow-y: auto;">
        <div style="max-width: 1200px; margin: 2rem auto; padding: 2rem; position: relative;">
            <button id="mangaDetailsClose" style="position: absolute; top: 1rem; right: 1rem;background: rgba(255,255,255,0.1); border: none; width: 40px; height: 40px; border-radius: 50%; color: white; font-size: 1.5rem; cursor: pointer; transition: all 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94), transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);">
                <i class="fas fa-times"></i>
            </button>
            
            <div style="display: flex; gap: 2rem; margin-bottom: 2rem;">
                <img id="mangaDetailsCover" src="" alt="Manga Cover" style="width: 300px; height: 450px; object-fit: cover; border-radius: 12px; box-shadow: 0 8px 24px rgba(0,0,0,0.5);">
                <div style="flex: 1; color: white;">
                    <h2 id="mangaDetailsTitle" style="font-size: 2.5rem; margin-bottom: 1rem; color: #ec4899;"></h2>
                    <p id="mangaDetailsAuthor" style="font-size: 1.1rem; margin-bottom: 0.5rem; color: #9ca3af;"></p>
                    <p id="mangaDetailsStatus" style="font-size: 1rem; margin-bottom: 1rem; color: #9ca3af;"></p>
                    <div id="mangaDetailsTags" style="display: flex; flex-wrap: wrap; gap: 0.5rem; margin-bottom: 1.5rem;">
                        <!-- Tags will be here -->
                    </div>
                    <p id="mangaDetailsDescription" style="line-height: 1.6; color: #d1d5db; font-size: 1rem;">
                        <!-- Description will be here -->
                    </p>
                </div>
            </div>
            
            <div>
                <h3 style="color: white; font-size: 1.5rem; margin-bottom: 1rem;">
                    <i class="fas fa-list"></i> Chapters
                </h3>
                <div id="mangaChaptersList" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 1rem; max-height: 500px; overflow-y: auto;">
                    <!-- Chapters will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Downloader Page -->
    <div id="downloader-page" style="display: none;">
        <div class="page-header-enhanced">
            <div class="page-title-section">
                <h2 class="section-title">
                    <i class="fas fa-download" style="color: #a855f7;"></i> <span>Downloader</span>
                </h2>
                <p class="page-subtitle">Download and manage your media files</p>
            </div>
        </div>

        <div class="trakt-container">
            <div class="trakt-card">
                <div class="trakt-card-body">
                    <div class="downloader-type-toggle" style="justify-content: center; margin-left: 0; margin-bottom: 1rem; border-bottom: 1px solid rgba(255, 255, 255, 0.1); padding-bottom: 1rem; width: 100%;">
                        <button id="provider111477" class="filter-btn active">111477</button>
                        <button id="providerAcermovies" class="filter-btn">acermovies</button>
                    </div>

                    <div id="111477-content">
                        <div class="downloader-search">
                            <input id="downloaderQuery" type="text" placeholder="Search movies or shows (e.g., Superman)" />
                            <button id="downloaderSearchBtn"><i class="fas fa-search"></i></button>
                            <div class="downloader-type-toggle">
                                <button id="downloaderFilterMovies" class="filter-btn active">Movies</button>
                                <button id="downloaderFilterTV" class="filter-btn">TV Shows</button>
                            </div>
                        </div>
                    </div>
                    <div id="acermovies-content" style="display: none;">
                        <!-- acermovies content will be loaded here -->
                    </div>

                    <div id="downloaderResults" class="downloader-results"></div>
                    <div id="downloaderEmpty" class="downloader-empty" style="display:none;">Type a search above to see results.</div>
                </div>
            </div>
        </div>
    </div>
</main>
    </div> <!-- End app-main -->
</div> <!-- End app-container -->

<!-- Anime Details Modal -->
<div class="modal" id="animeDetailsModal">
<div class="modal-content">
<button class="modal-close" id="animeModalClose">
<i class="fas fa-times"></i>
</button>
<div class="modal-header">
<img alt="Backdrop" class="modal-backdrop" id="animeModalBackdrop" src=""/>
<div class="modal-header-content">
<img alt="Poster" class="modal-poster" id="animeModalPoster" src=""/>
<div>
<h1 class="modal-title" id="animeModalTitle">Anime Title</h1>
<div class="modal-info">
<div class="modal-rating">
<i class="fas fa-star"></i> <span id="animeModalRating">0.0</span>
</div>
<div class="modal-year" id="animeModalYear">2023</div>
<div class="modal-runtime" id="animeModalEpisodes">24 Episodes</div>
</div>
<p class="modal-tagline" id="animeModalGenres">Action, Adventure</p>
</div>
</div>
</div>
<div class="modal-body">
<h3 class="modal-section-title">
<i class="fas fa-book-open"></i> Synopsis
</h3>
<p class="modal-overview" id="animeModalOverview">Synopsis goes here...</p>

<!-- Season/Episode Selector (only for series, not movies) -->
<div id="animeSeasonEpisodeContainer" style="display: none; margin: 1.5rem 0;">
<h3 class="modal-section-title">
<i class="fas fa-film"></i> Select Season & Episode
</h3>
<div style="display: flex; gap: 1rem; flex-wrap: wrap;">
    <div style="flex: 1; min-width: 200px;">
        <label style="display: block; margin-bottom: 0.5rem; color: var(--light); font-weight: 500; font-size: 0.95rem;">
            <i class="fas fa-layer-group"></i> Season
        </label>
        <select id="animeSeasonSelector" style="width: 100%; padding: 0.75rem;background: linear-gradient(135deg, rgba(59, 130, 246, 0.15), rgba(37, 99, 235, 0.15)); border: 1px solid rgba(59, 130, 246, 0.3); border-radius: 8px; color: var(--light); font-size: 1rem; cursor: pointer; font-weight: 500; transition: all 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94), transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);">
            <option value="" style="background: #1a1a2e; color: var(--light);">All Seasons</option>
        </select>
    </div>
    <div style="flex: 1; min-width: 200px;">
        <label style="display: block; margin-bottom: 0.5rem; color: var(--light); font-weight: 500; font-size: 0.95rem;">
            <i class="fas fa-play-circle"></i> Episode
        </label>
        <select id="animeEpisodeSelector" style="width: 100%; padding: 0.75rem;background: linear-gradient(135deg, rgba(59, 130, 246, 0.15), rgba(37, 99, 235, 0.15)); border: 1px solid rgba(59, 130, 246, 0.3); border-radius: 8px; color: var(--light); font-size: 1rem; cursor: pointer; font-weight: 500; transition: all 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94), transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);">
            <option value="" style="background: #1a1a2e; color: var(--light);">All Episodes</option>
        </select>
    </div>
</div>
<div style="background: rgba(59, 130, 246, 0.1); border-left: 3px solid #3b82f6; padding: 0.75rem 1rem; margin-top: 1rem; border-radius: 6px; font-size: 0.9rem; color: var(--light);">
<i class="fas fa-info-circle" style="color: #3b82f6; margin-right: 0.5rem;"></i>
<strong>Tip:</strong> Select "All Seasons" or "All Episodes" to find complete packs, or choose a specific season/episode for targeted results.
</div>
</div>

<!-- Realm Streaming Sources Button (outside container so it shows for movies too) -->
<div style="margin: 1.5rem 0; display: flex; gap: 0.75rem; flex-wrap: wrap;">
    <button id="animeDirectStreamBtn" style="flex: 1; min-width: 150px; padding: 0.75rem 1.5rem;background: linear-gradient(135deg, #10b981, #059669); border: none; border-radius: 8px; color: white; font-weight: 500; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 0.5rem; transition: all 0.3s ease;">
        <i class="fas fa-external-link-alt"></i> Direct Stream
    </button>
    <button id="animeRealmSourcesBtn" style="flex: 1; min-width: 150px; padding: 0.75rem 1.5rem;background: linear-gradient(135deg, #8b5cf6, #6d28d9); border: none; border-radius: 8px; color: white; font-weight: 500; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 0.5rem; transition: all 0.3s ease;">
        <i class="fas fa-play-circle"></i> Stream from Realm
    </button>
    <button id="animeFindTorrentsBtn" style="flex: 1; min-width: 150px; padding: 0.75rem 1.5rem;background: linear-gradient(135deg, #3b82f6, #2563eb); border: none; border-radius: 8px; color: white; font-weight: 500; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 0.5rem; transition: all 0.3s ease;">
        <i class="fas fa-magnet"></i> Find Torrents
    </button>
</div>

<!-- Realm Sources Container -->
<div class="torrents-container" id="animeRealmSourcesContainer" style="display: none; margin-top: 1.5rem;">
<div class="torrents-header">
<h3 class="modal-section-title">
<i class="fas fa-server"></i> Realm Streaming Sources
</h3>
<div class="torrent-actions">
<button class="btn btn-outline" id="animeRefreshRealmSources">
<i class="fas fa-sync"></i> Refresh
</button>
</div>
</div>

<div class="torrents-list" id="animeRealmSourcesList">
<!-- Realm sources will be loaded here -->
</div>
</div>

<!-- Torrents section -->
<div class="torrents-container" id="animeTorrentsContainer" style="display: none;">
<div class="torrents-header">
<h3 class="modal-section-title">
<i class="fas fa-magnet"></i> Available Torrents from Nyaa
</h3>
<div class="torrent-actions">
<button class="btn btn-outline" id="animeRefreshTorrents">
<i class="fas fa-sync"></i> Refresh
</button>
</div>
</div>

<!-- Custom Search Section -->
<div style="margin-bottom: 1.5rem; padding-bottom: 1.5rem; border-bottom: 1px solid rgba(255,255,255,0.1);">
<h4 style="color: var(--light); font-size: 0.95rem; margin-bottom: 0.75rem; display: flex; align-items: center; gap: 0.5rem;">
<i class="fas fa-search" style="color: #3b82f6;"></i>
Can't find what you're looking for? Try a custom search
</h4>
<div style="display: flex; gap: 0.5rem; align-items: stretch;">
<input type="text" id="animeCustomSearchInput" placeholder="Enter your own search query (e.g., 'Dragon Ball S02E01 1080p')" style="flex: 1; padding: 0.75rem 1rem;background: rgba(255,255,255,0.1); border: 1px solid rgba(59, 130, 246, 0.3); border-radius: 8px; color: var(--light); font-size: 0.95rem;">
<button id="animeCustomSearchBtn" style="padding: 0.75rem 1.5rem;background: linear-gradient(135deg, #3b82f6, #2563eb); border: none; border-radius: 8px; color: white; font-weight: 500; cursor: pointer; display: flex; align-items: center; gap: 0.5rem; transition: all 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94), transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);">
<i class="fas fa-search"></i> Search
</button>
</div>
</div>

<div style="margin-bottom: 1rem;">
<input type="text" id="animeTorrentKeywordFilter" placeholder="Filter torrents by keyword (e.g., 1080p, BluRay, SubsPlease)..." style="width: 100%; padding: 0.6rem;background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: var(--light); font-size: 0.95rem;">
</div>
<div class="torrents-list" id="animeTorrentsList">
<!-- Torrents will be loaded here -->
</div>
</div>
</div>
</div>
</div>

<!-- Movie/Show Details Modal -->
<div class="modal" id="detailsModal">
<div class="modal-content">
<button class="modal-close" id="modalClose">
<i class="fas fa-times"></i>
</button>
<div class="modal-header">
<img alt="Backdrop" class="modal-backdrop" id="modalBackdrop" src=""/>
<div class="modal-header-content">
<img alt="Poster" class="modal-poster" id="modalPoster" src=""/>
<div>
<h1 class="modal-title" id="modalTitle">Movie Title</h1>
<div class="modal-info">
<div class="modal-rating">
<i class="fas fa-star"></i> <span id="modalRating">0.0</span>
</div>
<div class="modal-year" id="modalYear">2023</div>
<div class="modal-runtime" id="modalRuntime">120 min</div>
</div>
<p class="modal-tagline" id="modalTagline">Tagline goes here</p>
<div class="modal-actions-container">
    <div class="primary-actions">
        <button class="btn-enhanced btn-enhanced-primary" id="watchNowBtn">
            <div class="btn-icon">
                <i class="fas fa-play-circle"></i>
            </div>
            <div class="btn-content">
                <span class="btn-title">Find Media</span>
                <span class="btn-subtitle">Search torrents & streams</span>
            </div>
        </button>
        <button class="btn-enhanced btn-enhanced-secondary" id="useStreamsBtn">
            <div class="btn-icon">
                <i class="fas fa-broadcast-tower"></i>
            </div>
            <div class="btn-content">
                <span class="btn-title">Direct Streams</span>
                <span class="btn-subtitle">No downloads needed</span>
            </div>
        </button>
    </div>
    <div class="secondary-actions">
        <button class="btn-icon-only" id="watchTrailerBtn" title="Watch Trailer">
            <i class="fas fa-film"></i>
        </button>
        <button class="btn-icon-only" id="traktWatchlistBtn" style="display: none;" title="Add to Watchlist">
            <i class="fas fa-plus"></i>
        </button>
        <button class="btn-icon-only done-watching-btn" id="modalDoneWatchingBtn" title="Done Watching">
            <i class="fas fa-check"></i>
        </button>
    </div>
    <div id="watchNowNote" class="action-note" style="display:none;">
        <i class="fas fa-info-circle"></i>
        Please select an episode first
    </div>
</div>
</div>
</div>
</div>
<div class="modal-body">
<h3 class="modal-section-title">
<i class="fas fa-book-open"></i> Overview
                </h3>
<p class="modal-overview" id="modalOverview">Overview goes here...</p>

<!-- Seasons selector for TV shows -->
<div class="seasons-container" id="seasonsContainer" style="display: none;">
<h3 class="modal-section-title">
<i class="fas fa-tv"></i> Seasons
                    </h3>
<div style="background: rgba(139, 92, 246, 0.1); border-left: 3px solid var(--secondary); padding: 0.75rem 1rem; margin-bottom: 1rem; border-radius: 6px; font-size: 0.9rem; color: var(--light);">
<i class="fas fa-info-circle" style="color: var(--secondary); margin-right: 0.5rem;"></i>
<strong>Tip:</strong> Click a <strong>Season</strong> button to find torrents for the entire season, or click a specific <strong>Episode</strong> to find torrents for just that episode.
</div>
<div class="season-selector" id="seasonSelector">
<!-- Seasons buttons will be loaded here -->
</div>
<h3 class="modal-section-title">
<i class="fas fa-list"></i> Episodes
                    </h3>
<div class="episodes-grid" id="episodesGrid">
<!-- Episodes will be loaded here -->
</div>
</div>

<h3 class="modal-section-title">
<i class="fas fa-users"></i> Cast
                </h3>
<div class="cast-grid" id="castGrid">
<!-- Cast members will be loaded here -->
</div>

<h3 class="modal-section-title">
<i class="fas fa-thumbs-up"></i> Similar Content
                </h3>
<div class="similar-grid" id="similarGrid">
<!-- Similar movies/shows will be loaded here -->
</div>

<!-- Torrents section -->
<div class="torrents-container" id="torrentsContainer" style="display: none;">
<div class="torrents-header">
<h3 class="modal-section-title">
<i class="fas fa-magnet"></i> Available Torrents
                        </h3>
<div class="torrent-actions">
    <label for="torrentSortSelect" style="margin-right: 0.5rem; font-size:0.9rem; opacity:0.85;">Sort:</label>
    <select id="torrentSortSelect" class="modal-select" style="margin-right: 0.5rem;">
        <option value="seeders">Seeds (default)</option>
        <option value="size-desc">Size: High → Low</option>
        <option value="size-asc">Size: Low → High</option>
    </select>
    <label for="torrentSizeFilterSelect" style="margin: 0 0.5rem 0 0.25rem; font-size:0.9rem; opacity:0.85;">Size:</label>
    <select id="torrentSizeFilterSelect" class="modal-select" style="margin-right: 0.5rem;">
        <option value="all">All sizes</option>
        <option value="gte-1g">≥ 1 GB</option>
        <option value="gte-2g">≥ 2 GB</option>
        <option value="2-4g">2–4 GB</option>
        <option value="4-8g">4–8 GB</option>
        <option value="gte-8g">≥ 8 GB</option>
    </select>
<button class="btn btn-outline" id="refreshTorrents">
<i class="fas fa-sync"></i> Refresh
                            </button>
</div>
</div>
<div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-left: 4px solid #ffd700; padding: 1rem; margin-bottom: 1.5rem; border-radius: 8px; box-shadow: 0 2px 10px rgba(102, 126, 234, 0.3);">
<div style="display: flex; align-items: center; gap: 0.75rem;">
<i class="fas fa-volume-up" style="color: #ffd700; font-size: 1.5rem;"></i>
<div>
<strong style="color: #fff; font-size: 1.05rem;">Audio Issues?</strong>
<p style="margin: 0.25rem 0 0 0; color: rgba(255, 255, 255, 0.9); font-size: 0.95rem;">
If you experience audio problems or no audio at all, click <strong>"Open in MPV"</strong> for the best playback experience.
                        </p>
</div>
</div>
</div>
<div class="provider-buttons">
    <button class="provider-btn active" data-provider="jackett">
        <i class="fas fa-link"></i> Jackett
    </button>

    <button class="provider-btn" data-provider="torrentio">
        <i class="fas fa-rocket"></i> Torrentio
    </button>

    <button class="provider-btn" data-provider="torrentless">
        <i class="fas fa-tools"></i> PlayTorrio
    </button>

    <button class="provider-btn" data-provider="nuvio">
        <i class="fas fa-stream"></i> Nuvio <span style="font-size: 0.8em; opacity: 0.8;">(ShowBox)</span>
    </button>

    <button class="provider-btn" data-provider="comet">
        <i class="fas fa-meteor"></i> Comet
    </button>

    <button class="provider-btn" data-provider="111477">
        <i class="fas fa-play-circle"></i> 111477
    </button>

    <button class="provider-btn" data-provider="moviebox">
        <i class="fas fa-film"></i> Moviebox
    </button>

    <button class="provider-btn" data-provider="xdmovies">
        <i class="fas fa-film"></i> XDMovies
    </button>

    <button class="provider-btn" data-provider="aiostreams">
        <i class="fas fa-bolt"></i> AIOStreams
    </button>
    
    <!-- Dynamic addon buttons will be inserted here -->
    <span id="addonProviderButtons" style="display: contents;"></span>
</div>

</button>
</div>
<div style="margin-bottom: 1rem;">
<input type="text" id="torrentKeywordFilter" placeholder="Filter torrents by keyword..." style="width: 100%; padding: 0.6rem;background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: var(--light); font-size: 0.95rem;">
</div>
<div class="torrents-list" id="torrentsList">
<!-- Torrents will be loaded here -->
</div>
</div>
</div>
</div>
</div>

<!-- Trailer Modal -->
<div id="trailerModal" class="modal" style="z-index: 10001;">
    <div class="modal-content" style="max-width: 900px;background: #0a0a0f;">
        <button class="modal-close" id="trailerModalClose">
            <i class="fas fa-times"></i>
        </button>
        <div style="padding: 1rem;">
            <h2 style="margin-bottom: 1rem; font-size: 1.5rem; display: flex; align-items: center; gap: 0.5rem;">
                <i class="fas fa-film" style="color: var(--secondary);"></i>
                <span id="trailerModalTitle">Trailer</span>
            </h2>
            <div id="trailerContainer" style="aspect-ratio: 16/9;background: #000; border-radius: 8px; overflow: hidden;">
                <div id="trailerPlaceholder" style="width: 100%; height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; color: rgba(255,255,255,0.5);">
                    <i class="fas fa-spinner fa-spin" style="font-size: 2rem; margin-bottom: 0.5rem;"></i>
                    <p>Loading trailer...</p>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Embedded Player Overlay (iframe) -->
<div id="player-overlay" class="fixed inset-0 z-[10000] bg-black hidden" style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; z-index: 10000;background: #000; display: none;">
    <iframe id="player-iframe" style="width: 100%; height: 100%; border: 0;" allowfullscreen></iframe>
</div>

<!-- MPV Player / Torrent File Selector -->
<div class="vlc-player-container" id="mpvPlayerContainer" style="display: none;">
    <div class="vlc-player-header">
        <div class="vlc-player-title" id="playerTitle">Player <span class="source-badge webtorrent" id="streamSourceBadge" title="Streaming source">WebTorrent</span></div>
    </div>
    <div class="vlc-player-content">
        <div class="file-selector" id="fileSelector">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                <h3 style="margin: 0;"><i class="fas fa-folder-open"></i> Select File to Play</h3>
                <button class="close-player-btn" id="closePlayerBtn" title="Close Player (Esc)" style="padding: 0.5rem 1rem;background: #f97316; border: none; color: white; border-radius: 4px; cursor: pointer; font-weight: 600; font-size: 0.95rem;">
                    <i class="fas fa-times"></i> Close
                </button>
            </div>
            <div class="file-list" id="fileList">
                <!-- Files will be loaded here -->
            </div>
        </div>

        <div class="subtitle-controls" id="subtitleControls" style="display: none;">
            <h4><i class="fas fa-closed-captioning"></i> Available Subtitles:</h4>
            <div id="subtitleList">
                <!-- Subtitle files will be loaded here -->
            </div>
        </div>

        <div class="vlc-player-area" id="mpvPlayerArea">
            <div class="vlc-loading" id="mpvLoading" style="display: none;">
                <i class="fas fa-spinner fa-spin"></i>
                <span>Loading...</span>
            </div>
        </div>

        <div class="vlc-controls" id="mpvControls" style="display: none;">
            <button class="vlc-btn secondary" id="copyStreamBtn">
                <i class="fas fa-copy"></i> Copy Link
            </button>
            <button class="vlc-btn" id="playNowBtn">
                <i class="fas fa-play"></i> Play Now
            </button>
            <button class="vlc-btn" id="openMPVBtn">
                <i class="fas fa-external-link-alt"></i> Open in MPV
            </button>
            <button class="vlc-btn" id="openVLCBtn">
                <i class="fas fa-external-link-alt"></i> Open in VLC
            </button>
        </div>
    </div>
</div>

<!-- Custom Video Player -->
<div class="custom-player-container" id="customPlayerContainer" style="display: none;">
    <div class="player-header">
        <div class="player-title" id="customPlayerTitle">
            <i class="fas fa-play-circle"></i>
            <span>Custom Player</span> <span class="source-badge webtorrent" id="customSourceBadge" title="Streaming source">WebTorrent</span>
        </div>
        <button class="close-player-btn" id="closeCustomPlayer" title="Close Player (Esc)">
            <i class="fas fa-times"></i> Close
        </button>
    </div>

    <div class="video-container" id="videoContainer">
        <video class="custom-video video-js" id="customVideo" preload="metadata">
            <source id="videoSource" src="" type="video/mp4">
            Your browser does not support the video tag.
        </video>

        <div class="loading-overlay" id="loadingOverlay" style="display: none;">
            <i class="fas fa-spinner fa-spin"></i>
            <span>Loading video...</span>
        </div>

        <div class="subtitle-display" id="subtitleDisplay"></div>

        <div class="video-controls" id="videoControls">
            <div class="progress-container">
                <div class="progress-bar" id="progressBar">
                    <div class="progress-filled" id="progressFilled"></div>
                </div>
                <div class="progress-time">
                    <span id="currentTime">0:00</span>
                    <span id="totalTime">0:00</span>
                </div>
            </div>

            <div class="control-bar">
                <div class="control-left">
                    <button class="control-btn" id="rewindBtn" title="Rewind 10s"><i class="fas fa-backward"></i></button>
                    <button class="control-btn play-pause" id="playPauseBtn" title="Play/Pause"><i class="fas fa-play"></i></button>
                    <button class="control-btn" id="forwardBtn" title="Forward 10s"><i class="fas fa-forward"></i></button>
                </div>
                <div class="control-right">
                    <div class="volume-group">
                        <button class="control-btn" id="htmlMuteBtn" title="Mute/Unmute"><i class="fas fa-volume-up"></i></button>
                        <input type="range" id="htmlVolume" class="volume-slider" min="0" max="100" value="80" />
                    </div>
                    <button class="control-btn" id="htmlSubsBtn" title="Subtitles"><i class="fas fa-closed-captioning"></i></button>
                    <button class="control-btn" id="fullscreenBtn" title="Fullscreen"><i class="fas fa-expand"></i></button>
                </div>
            </div>
        </div>
    </div>
</div>


<!-- External Libraries -->
<script src="https://vjs.zencdn.net/8.10.0/video.min.js"></script>

<!-- Performance Boost (load first) -->
<script src="js/performance-boost.js"></script>

<!-- Defer heavy rendering until after page load -->
<script>
// Hide content until fully loaded to prevent janky initial render
document.documentElement.style.visibility = 'hidden';
window.addEventListener('DOMContentLoaded', () => {
    requestAnimationFrame(() => {
        document.documentElement.style.visibility = 'visible';
    });
});
</script>

<!-- Modular JavaScript Files -->
<script src="js/config.js?v=2"></script>
<script src="js/theme.js?v=2"></script>
<script src="js/dom.js?v=2"></script>
<script src="js/notifications.js?v=2"></script>
<script src="js/utils.js?v=2"></script>
<script src="js/api.js?v=2"></script>
<script src="js/torrents.js?v=2"></script>
<script src="js/movies.js?v=2"></script>
<script src="js/catalogs.js?v=2"></script>
<script src="js/navigation.js?v=2"></script>
<script src="js/settings.js?v=2"></script>
<script src="js/trakt.js?v=2"></script>
<script src="js/ui.js?v=2"></script>
<script src="js/servers.js?v=2"></script>
<script src="js/player.js?v=2"></script>
<script src="js/downloader.js?v=2"></script>
<script src="js/iptv.js?v=2"></script>
<script src="js/livetv.js?v=2"></script>
<script src="js/audiobooks.js?v=2"></script>
<script src="js/books.js?v=2"></script>
<script src="js/epubReader.js?v=2"></script>
<script src="js/booktorrio.js?v=2"></script>
<script src="js/music.js?v=2"></script>
<script src="js/manga.js?v=2"></script>
<script src="js/comics.js?v=2"></script>
<script src="js/anime.js?v=2"></script>
<script src="js/games.js?v=2"></script>
<script src="js/streaming.js?v=2"></script>
<script src="js/event-listeners.js?v=2"></script>
<script src="js/app.js?v=2"></script>

<!-- Floating Settings Menu -->
<div class="floating-settings-container" id="floatingSettingsContainer">
    <div class="floating-settings-menu" id="floatingSettingsMenu">
        <div class="floating-menu-section">
            <div class="floating-menu-title">Browse</div>
            <div class="floating-menu-item" data-page="home">
                <i class="fas fa-home"></i>
                <span>Home</span>
            </div>
            <div class="floating-menu-item" data-page="genres">
                <i class="fas fa-layer-group"></i>
                <span>Genres</span>
            </div>
            <div class="floating-menu-item" data-page="my-list">
                <i class="fas fa-heart"></i>
                <span>My List</span>
            </div>
            <div class="floating-menu-item" data-page="done-watching">
                <i class="fas fa-check-circle"></i>
                <span>Done Watching</span>
            </div>
        </div>
        <div class="floating-menu-section">
            <div class="floating-menu-title">Media</div>
            <div class="floating-menu-item" data-page="music">
                <i class="fas fa-music"></i>
                <span>Music</span>
            </div>
            <div class="floating-menu-item" data-page="audiobooks">
                <i class="fas fa-headphones"></i>
                <span>Audiobooks</span>
            </div>
            <div class="floating-menu-item" data-page="books">
                <i class="fas fa-book"></i>
                <span>Books</span>
            </div>
            <div class="floating-menu-item" data-page="comics">
                <i class="fas fa-book-open"></i>
                <span>Comics</span>
            </div>
            <div class="floating-menu-item" data-page="manga">
                <i class="fas fa-dragon"></i>
                <span>Manga</span>
            </div>
        </div>
        <div class="floating-menu-section">
            <div class="floating-menu-title">More</div>
            <div class="floating-menu-item" data-page="iptv">
                <i class="fas fa-tv"></i>
                <span>IPTV</span>
            </div>
            <div class="floating-menu-item" data-page="anime">
                <i class="fas fa-torii-gate"></i>
                <span>Anime</span>
            </div>
            <div class="floating-menu-item" data-page="trakt">
                <i class="fas fa-chart-line"></i>
                <span>Trakt</span>
            </div>
            <div class="floating-menu-item" data-page="downloader">
                <i class="fas fa-download"></i>
                <span>Downloader</span>
            </div>
        </div>
        <div class="floating-menu-section">
            <div class="floating-menu-item settings-item" data-page="settings">
                <i class="fas fa-cog"></i>
                <span>Settings</span>
            </div>
        </div>
    </div>
    <button class="floating-settings-btn" id="floatingSettingsBtn" title="Quick Menu">
        <i class="fas fa-cog"></i>
    </button>
</div>

<!-- Player Overlay Management -->
<script>
    // Player overlay management for HTML5 player iframe
    window.playerOverlay = {
        overlay: null,
        iframe: null,
        currentStreamHash: null,
        isAltEngine: false,
        isClosing: false,

        init() {
            console.log('[PlayerOverlay] Initializing...');
            
            // Create overlay container
            this.overlay = document.createElement('div');
            this.overlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: #000;
                z-index: 99999;
                display: none;
            `;
            
            // Create iframe
            this.iframe = document.createElement('iframe');
            this.iframe.style.cssText = `
                width: 100%;
                height: 100%;
                border: none;
            `;
            this.iframe.allow = 'autoplay; fullscreen; picture-in-picture';
            this.iframe.allowFullscreen = true;
            
            this.overlay.appendChild(this.iframe);
            document.body.appendChild(this.overlay);
            
            // Handle iframe load errors
            this.iframe.addEventListener('error', () => {
                console.error('[PlayerOverlay] Iframe load error');
                this.close();
            });
            
            console.log('[PlayerOverlay] Initialized successfully');
        },

        open(playerUrl, streamHash = null, isAltEngine = false) {
            if (!this.overlay || !this.iframe) this.init();
            
            this.isClosing = false;
            this.currentStreamHash = streamHash || null;
            this.isAltEngine = isAltEngine || false;
            
            console.log('[PlayerOverlay] Opening player:', playerUrl);
            console.log('[PlayerOverlay] Stream hash:', this.currentStreamHash);
            console.log('[PlayerOverlay] Alt engine:', this.isAltEngine);
            
            this.iframe.src = playerUrl;
            this.overlay.style.display = 'block';
            document.body.style.overflow = 'hidden';
        },

        close() {
            if (this.isClosing) {
                console.log('[PlayerOverlay] Already closing, ignoring duplicate call');
                return;
            }
            
            this.isClosing = true;
            console.log('[PlayerOverlay] Closing player...');
            
            // Cleanup stream if we have a hash (local torrent stream)
            if (this.currentStreamHash) {
                const endpoint = this.isAltEngine ? '/api/alt-stop-stream' : '/api/stop-stream';
                console.log('[PlayerOverlay] Stopping stream:', this.currentStreamHash);
                fetch(`${API_BASE_URL.replace('/api', '')}${endpoint}?hash=${this.currentStreamHash}`)
                    .then(() => console.log('[PlayerOverlay] Stream stopped'))
                    .catch(e => console.warn('[PlayerOverlay] Stream stop error:', e));
                
                this.currentStreamHash = null;
                this.isAltEngine = false;
            }
            
            // Clear iframe and hide overlay
            this.iframe.src = 'about:blank';
            this.overlay.style.display = 'none';
            document.body.style.overflow = '';
            
            // Reset closing flag after a short delay
            setTimeout(() => {
                this.isClosing = false;
            }, 500);
            
            console.log('[PlayerOverlay] Player closed');
        }
    };
    
    // Listen for messages from the player iframe
    window.addEventListener('message', (event) => {
        if (event.data?.type === 'player-close') {
            console.log('[PlayerOverlay] Received close message from player');
            if (window.playerOverlay) {
                window.playerOverlay.close();
            }
        } else if (event.data?.type === 'player-cleanup') {
            console.log('[PlayerOverlay] Received cleanup message:', event.data.hash);
            if (window.playerOverlay && event.data.hash) {
                window.playerOverlay.currentStreamHash = event.data.hash;
            }
        }
    });
    
    // Initialize on DOM ready
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', () => window.playerOverlay.init());
    } else {
        window.playerOverlay.init();
    }
</script>

</body>
</html>

